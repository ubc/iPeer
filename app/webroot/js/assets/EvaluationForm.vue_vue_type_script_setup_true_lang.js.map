{"version":3,"file":"EvaluationForm.vue_vue_type_script_setup_true_lang.js","sources":["../../../vueapp/src/components/fields/CustomHiddenField.vue","../../../vueapp/src/student/views/EvaluationForm.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { toRef } from 'vue';\nimport { useField } from 'vee-validate';\n\nconst props = defineProps<{\n  name: string,\n  value: string,\n  modelValue: string|number\n}>();\n\nconst name = toRef(props, 'name');\nconst { checked, handleChange } = useField(name, undefined, {\n  type: 'hidden',\n  checkedValue: props.value,\n});\n</script>\n\n<template>\n  <input type=\"hidden\" :name=\"name\" :value=\"props.value\" :checked=\"checked\" />\n</template>\n","<script lang=\"ts\" setup>\nimport { ref, watch } from 'vue'\nimport { useRouter } from 'vue-router'\nimport api from '@/services/api'\nimport { useEvaluationStore } from '@/stores/evaluation'\nimport { useForm } from 'vee-validate'\nimport { cloneDeep, debounce } from 'lodash'\nimport type {IEvaluation, IMixedResponse, IRubricResponse, ISimpleResponse} from '@/types/typings'\n\ninterface Props {\n  evaluation: IEvaluation\n  initialState: ISimpleResponse | IRubricResponse | IMixedResponse\n}\n\n// REFERENCES\nconst emit = defineEmits<{\n  (e: 'on:submit', option: any): void\n  (e: 'on:save', option: any): void\n}>()\nconst props = defineProps<Props>()\nconst router = useRouter()\nconst {values, errors, meta, handleSubmit, isSubmitting} = useForm({\n  initialValues: props.initialState?.data,\n})\nconst evaluationStore = useEvaluationStore()\n// DATA\nconst evaluation_form = ref()\nconst message = ref<object|null>(null)\nconst autosave = ref<boolean>(false)\n// COMPUTED\n// METHODS\nfunction onInvalidateSubmit({errors}: any) {\n  const fieldName = Object.keys(errors)[0]\n  const fieldElement = document.getElementById(fieldName)\n  fieldElement?.focus?.()\n  fieldElement?.scrollIntoView({behavior: 'smooth'})\n}\n\nconst onSubmit = handleSubmit(async () => {\n  message.value = null\n  const formData = new FormData(evaluation_form.value)\n  formData.append('_method', 'POST')\n  const searchParams = new URLSearchParams()\n  for (const pair of formData) {\n    searchParams.append(pair[0], pair[1])\n  }\n  await evaluationStore.makeEvaluation(searchParams, props.evaluation?.id, props.evaluation?.group?.id)\n}, onInvalidateSubmit)\n\nasync function onSave() {\n  const formData = new FormData(evaluation_form.value)\n  formData.append('_method', 'PUT')\n  const searchParams = new URLSearchParams()\n  for (const pair of formData) {\n    searchParams.append(pair[0], pair[1])\n  }\n  await evaluationStore.editEvaluation(searchParams, props.evaluation?.id, props.evaluation?.group?.id)\n}\n\n// WATCH\nwatch(() => cloneDeep(props.initialState), debounce(async (current, previous) => {\n  if(!props.evaluation?.is_result_released) {\n    const formData = new FormData(evaluation_form.value)\n    formData.append('_method', 'PUT')\n    const searchParams = new URLSearchParams()\n    for (const pair of formData) {\n      searchParams.append(pair[0], pair[1])\n    }\n    await evaluationStore.autoSaveEvaluation(searchParams, props.evaluation?.id, props.evaluation?.group?.id)\n  }\n}, 5000), {deep: true})\n// LIFECYCLE\n</script>\n\n<template>\n  <form novalidate @submit.prevent=\"onSubmit\" id=\"evaluation_form\" class=\"evaluation-form\" ref=\"evaluation_form\">\n    <slot :values=\"values\"\n          :errors=\"errors\"\n          :form-meta=\"meta\"\n          :is-submitting=\"isSubmitting\"\n          :onSave=\"onSave\"\n          :evaluation-ref=\"evaluation_form\"/>\n  </form>\n</template>\n"],"names":["name","toRef","props","checked","handleChange","useField","useRouter","values","errors","meta","handleSubmit","isSubmitting","useForm","_a","evaluationStore","useEvaluationStore","evaluation_form","ref","message","onInvalidateSubmit","fieldName","fieldElement","onSubmit","formData","searchParams","pair","_c","_b","onSave","watch","cloneDeep","debounce","current","previous","_d"],"mappings":"2RAUMA,EAAOC,EAAMC,EAAO,MAAM,EAC1B,CAAE,QAAAC,EAAS,aAAAC,CAAA,EAAiBC,EAASL,EAAM,OAAW,CAC1D,KAAM,SACN,aAAcE,EAAM,KAAA,CACrB,wOCMcI,EAAU,EACzB,KAAM,CAAC,OAAAC,EAAQ,OAAAC,EAAQ,KAAAC,EAAM,aAAAC,EAAc,aAAAC,GAAgBC,EAAQ,CACjE,eAAeC,EAAAX,EAAM,eAAN,YAAAW,EAAoB,IAAA,CACpC,EACKC,EAAkBC,IAElBC,EAAkBC,IAClBC,EAAUD,EAAiB,IAAI,EACpBA,EAAa,EAAK,EAGnC,SAASE,EAAmB,CAAC,OAAAX,GAAc,OACzC,MAAMY,EAAY,OAAO,KAAKZ,CAAM,EAAE,GAChCa,EAAe,SAAS,eAAeD,CAAS,GACtDP,EAAAQ,GAAA,YAAAA,EAAc,QAAd,MAAAR,EAAA,KAAAQ,GACAA,GAAA,MAAAA,EAAc,eAAe,CAAC,SAAU,QAAS,EACnD,CAEM,MAAAC,EAAWZ,EAAa,SAAY,WACxCQ,EAAQ,MAAQ,KAChB,MAAMK,EAAW,IAAI,SAASP,EAAgB,KAAK,EAC1CO,EAAA,OAAO,UAAW,MAAM,EAC3B,MAAAC,EAAe,IAAI,gBACzB,UAAWC,KAAQF,EACjBC,EAAa,OAAOC,EAAK,GAAIA,EAAK,EAAE,EAEhC,MAAAX,EAAgB,eAAeU,GAAcX,EAAAX,EAAM,aAAN,YAAAW,EAAkB,IAAIa,GAAAC,EAAAzB,EAAM,aAAN,YAAAyB,EAAkB,QAAlB,YAAAD,EAAyB,EAAE,GACnGP,CAAkB,EAErB,eAAeS,GAAS,WACtB,MAAML,EAAW,IAAI,SAASP,EAAgB,KAAK,EAC1CO,EAAA,OAAO,UAAW,KAAK,EAC1B,MAAAC,EAAe,IAAI,gBACzB,UAAWC,KAAQF,EACjBC,EAAa,OAAOC,EAAK,GAAIA,EAAK,EAAE,EAEhC,MAAAX,EAAgB,eAAeU,GAAcX,EAAAX,EAAM,aAAN,YAAAW,EAAkB,IAAIa,GAAAC,EAAAzB,EAAM,aAAN,YAAAyB,EAAkB,QAAlB,YAAAD,EAAyB,EAAE,CACtG,CAGM,OAAAG,EAAA,IAAMC,oBAAU5B,EAAM,YAAY,EAAG6B,mBAAS,MAAOC,EAASC,IAAa,aAC5E,GAAA,GAACpB,EAAAX,EAAM,aAAN,MAAAW,EAAkB,oBAAoB,CACxC,MAAMU,EAAW,IAAI,SAASP,EAAgB,KAAK,EAC1CO,EAAA,OAAO,UAAW,KAAK,EAC1B,MAAAC,EAAe,IAAI,gBACzB,UAAWC,KAAQF,EACjBC,EAAa,OAAOC,EAAK,GAAIA,EAAK,EAAE,EAEhC,MAAAX,EAAgB,mBAAmBU,GAAcG,EAAAzB,EAAM,aAAN,YAAAyB,EAAkB,IAAIO,GAAAR,EAAAxB,EAAM,aAAN,YAAAwB,EAAkB,QAAlB,YAAAQ,EAAyB,EAAE,CAC1G,GACC,GAAI,EAAG,CAAC,KAAM,EAAK,CAAA"}