{"version":3,"file":"EvaluationForm.vue_vue_type_script_setup_true_lang.js","sources":["../../../vueapp/src/components/fields/CustomHiddenField.vue","../../../vueapp/src/student/views/EvaluationForm.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { toRef } from 'vue';\nimport { useField } from 'vee-validate';\n\nconst props = defineProps<{\n  name: string,\n  value: string,\n  modelValue: string|number\n}>();\n\nconst name = toRef(props, 'name');\nconst { checked, handleChange } = useField(name, undefined, {\n  type: 'hidden',\n  checkedValue: props.value,\n});\n</script>\n\n<template>\n  <input type=\"hidden\" :name=\"name\" :value=\"props.value\" :checked=\"checked\" />\n</template>\n","<script lang=\"ts\" setup>\nimport {ref, watch} from 'vue'\nimport {useRouter} from 'vue-router'\nimport api from '@/services/api'\nimport {useForm} from 'vee-validate'\nimport {cloneDeep, debounce} from 'lodash'\nimport type {IEvaluation, IMixedResponse, IRubricResponse, ISimpleResponse} from '@/types/typings'\n\ninterface Props {\n  evaluation: IEvaluation\n  initialState: ISimpleResponse | IRubricResponse | IMixedResponse\n}\n\n// REFERENCES\nconst emit = defineEmits<{\n  (e: 'on:submit', option: any): void\n  (e: 'on:save', option: any): void\n  (e: 'set:message', option: object): void\n}>()\nconst props = defineProps<Props>()\nconst router = useRouter()\nconst {values, errors, meta, handleSubmit, isSubmitting} = useForm({\n  initialValues: props.initialState?.data,\n})\n// DATA\nconst evaluation_form = ref()\nconst message = ref<object|null>(null)\nconst autosave = ref<boolean>(false)\n// COMPUTED\n// METHODS\nfunction onInvalidateSubmit({errors}: any) {\n  const fieldName = Object.keys(errors)[0]\n  const fieldElement = document.getElementById(fieldName)\n  fieldElement?.focus?.()\n  fieldElement?.scrollIntoView({behavior: 'smooth'})\n}\n\nconst onSubmit = handleSubmit(async () => {\n  message.value = null\n  const formData = new FormData(evaluation_form.value)\n  formData.append('_method', 'POST')\n  const searchParams = new URLSearchParams()\n  for (const pair of formData) {\n    searchParams.append(pair[0], pair[1])\n  }\n  try {\n    const response = await api.post('/evaluations/makeEvaluation/', `${props.evaluation?.id}/${props.evaluation?.group?.id}`, searchParams)\n    if(response.status === 200 && response.statusText === 'OK') {\n      message.value = response.data\n      await router.push({name: 'student.events'})\n    } else {\n      message.value = {message: response.statusText, status: response.status, type: response.statusText}\n    }\n  } catch (err: any) {\n    message.value = {message: err.response.message, type: 'error'}\n  }\n}, onInvalidateSubmit)\n\nasync function onSave() {\n  message.value = null\n  try {\n    const formData = new FormData(evaluation_form.value)\n    formData.append('_method', 'PUT')\n    const searchParams = new URLSearchParams()\n    for (const pair of formData) {\n      searchParams.append(pair[0], pair[1])\n    }\n    const response = await api.post('/evaluations/makeEvaluation/', `${props.evaluation?.id}/${props.evaluation?.group?.id}`, searchParams)\n    if(response.status === 200 && response.statusText === 'OK') {\n      message.value = response.data\n    } else {\n      message.value = {text: response.statusText, status: response.status, type: response.statusText}\n    }\n  } catch (err: any) {\n    message.value = {text: 'something went wrong...', status: 500, type: 'error'}\n  }\n}\n\n// WATCH\nwatch(() => cloneDeep(props.initialState), debounce(async (current, previous) => {\n  autosave.value = true\n  try {\n    const formData = new FormData(evaluation_form.value)\n    formData.append('_method', 'PUT')\n    const searchParams = new URLSearchParams()\n    for (const pair of formData) {\n      searchParams.append(pair[0], pair[1])\n    }\n    const response = await api.post('/evaluations/makeEvaluation/', `${props.evaluation?.id}/${props.evaluation?.group?.id}`, searchParams)\n    if(response.status === 200 && response.statusText === 'OK') {\n      autosave.value = false\n    }\n  } catch (err: any) {\n    message.value = { text: err.response.message, status: err.status, type: 'error' }\n  } finally {\n    autosave.value = false\n  }\n}, 5000), {deep: true})\nwatch(message, (event: object) => {\n  emit('set:message', event)\n}, { deep: true })\n// LIFECYCLE\n</script>\n\n<template>\n  <form novalidate @submit.prevent=\"onSubmit\" id=\"evaluation_form\" class=\"evaluation-form\" ref=\"evaluation_form\">\n    <slot :values=\"values\" :errors=\"errors\" :form-meta=\"meta\"  :is-submitting=\"isSubmitting\"\n         :message=\"message\" :autosave=\"autosave\" :onSave=\"onSave\" :evaluation-ref=\"evaluation_form\"/>\n  </form>\n</template>\n"],"names":["name","toRef","props","checked","handleChange","useField","router","useRouter","values","errors","meta","handleSubmit","isSubmitting","useForm","_a","evaluation_form","ref","message","autosave","onInvalidateSubmit","fieldName","fieldElement","onSubmit","formData","searchParams","pair","response","api","_c","_b","err","onSave","watch","cloneDeep","debounce","current","previous","event","emit"],"mappings":"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"}