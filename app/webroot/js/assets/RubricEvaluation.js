import{d as N,o as u,c as d,b as i,t as C,f as Q,F as R,e as E,n as Z,C as F,j as v,k as r,x as y,Q as M,D as z,r as W,S as ee,A as T,i as B,a3 as te,w as ie,g as L,a5 as ae,a6 as le}from"./main.js";import"./autosize.esm.js";import{_ as S,a as re}from"./EvaluationForm.vue_vue_type_script_setup_true_lang.js";import{h as ne,g as X}from"./rules.js";import{_ as se}from"./CustomRadioField.vue_vue_type_script_setup_true_lang.js";import{_ as O}from"./UserCard.vue_vue_type_script_setup_true_lang.js";import{_ as Y}from"./CustomTextField.vue_vue_type_script_setup_true_lang.js";import"./evaluation.js";const ue={class:"standardtable center no-v-line"},oe={style:{width:"20%"}},de={class:"flex flex-col"},ce={class:""},me={key:0,class:"small"},_e={class:"flex flex-col"},ve={class:""},be={class:"small"},pe=N({__name:"PeerRubricLikertQuestion",props:{members:null,initialState:null,rubric_criteria:null,rubrics_lom:null,disabled:{type:Boolean}},emits:["update:initialState"],setup(m,{emit:V}){const a=m;function p(o,n,_){const s=y.exports.find(a.initialState.data,{evaluatee:n});return s?y.exports.filter(s==null?void 0:s.details,t=>{if(t.criteria_number===_)return t})[0]:""}function l(o){if(!a.disabled){const n=document.forms[0],_=`selected_lom_${o.key}_${o.target}`;n.querySelector(`input[name=${_}]`).setAttribute("value",o.value)}}return(o,n)=>{var _,s,e;return u(),d("table",ue,[i("thead",null,[i("tr",null,[i("th",oe,[i("div",de,[i("div",ce,C((_=a.rubric_criteria)==null?void 0:_.criteria),1),parseInt((s=a.rubric_criteria)==null?void 0:s.show_marks)?(u(),d("small",me,"("+C((e=a.rubric_criteria)==null?void 0:e.multiplier)+" marks)",1)):Q("",!0)])]),(u(!0),d(R,null,E(a.rubrics_lom,(t,c)=>{var b,f;return u(),d("th",{style:Z("width: "+80/((b=a.rubrics_lom)==null?void 0:b.length)+"%"),key:t.id},[i("div",_e,[i("div",ve,C(t.lom_comment),1),i("small",be,C((f=a.rubric_criteria)==null?void 0:f.rubrics_criteria_comment[c].criteria_comment),1)])],4)}),128))])]),i("tbody",null,[(u(!0),d(R,null,E(a.members,(t,c)=>{var b,f,x,h;return u(),d(R,{key:t.id},[m.disabled?Q("",!0):(u(),F(S,{key:0,name:`selected_lom_${t.id}_${(b=m.rubric_criteria)==null?void 0:b.id}`,value:(h=(x=p("criteria_num",t.id,(f=m.rubric_criteria)==null?void 0:f.criteria_num))==null?void 0:x.selected_lom)!=null?h:""},null,8,["name","value"])),i("tr",null,[i("td",null,[v(O,{member:t},null,8,["member"])]),(u(!0),d(R,null,E(a.rubrics_lom,(P,j)=>{var w,I,D,q;return u(),d("td",{key:P.id},[v(se,{ref_for:!0,ref:"selected_lom",member_id:t.id,criteria_num:(w=a.rubric_criteria)==null?void 0:w.criteria_num,name:`${t.id}criteria_points_${(I=m.rubric_criteria)==null?void 0:I.id}`,value:P.lom_num,rules:r(ne),checked:(q=p("criteria_num",t.id,(D=m.rubric_criteria)==null?void 0:D.criteria_num))==null?void 0:q.selected_lom,disabled:a.disabled,onClick:g=>{var $;return l({target:($=m.rubric_criteria)==null?void 0:$.id,key:t.id,value:g.target.value})},onInput:g=>{var $;return o.$emit("update:initialState",{member_id:t.id,criteria_num:($=m.rubric_criteria)==null?void 0:$.criteria_num,event:{key:"selected_lom",value:g.target.value}})}},null,8,["member_id","criteria_num","name","value","rules","checked","disabled","onClick","onInput"])])}),128))])],64)}),128))])])}}}),fe={class:"standardtable center no-v-line"},he=i("thead",null,[i("tr",null,[i("th",{style:{width:"20%"}},[i("div",{class:"flex flex-col"},[i("div",{class:""},"Peer"),i("small",{class:"small"})])]),i("th",{style:{width:"80%"}},[i("div",{class:"flex flex-col"},[i("div",{class:""},"Comments"),i("small",{class:"small"})])])])],-1),ye={style:{width:"20%"}},$e={style:{width:"80%"}},xe=N({__name:"PeerRubricCommentQuestion",props:{members:null,initialState:null,rubric_criteria_idx:null,rubric_criteria:null,disabled:{type:Boolean}},emits:["update:initialState"],setup(m,{emit:V}){const a=m;M();function p(l,o,n){const _=y.exports.find(a.initialState.data,{evaluatee:o});return _?y.exports.filter(_==null?void 0:_.details,e=>{if(e.criteria_number===n)return e})[0]:""}return(l,o)=>(u(),d("table",fe,[he,i("tbody",null,[(u(!0),d(R,null,E(a.members,(n,_)=>{var s,e;return u(),d("tr",{key:n.id},[i("td",ye,[v(O,{member:n},null,8,["member"])]),i("td",$e,[v(Y,{id:`${n.id}comments[${(s=m.rubric_criteria)==null?void 0:s.id}]`,name:`${n.id}comments[${a.rubric_criteria_idx}]`,value:p("criteria_comment",n.id,(e=m.rubric_criteria)==null?void 0:e.criteria_num).criteria_comment,rules:r(X),disabled:a.disabled,onInput:t=>{var c;return l.$emit("update:initialState",{member_id:n.id,criteria_num:(c=m.rubric_criteria)==null?void 0:c.criteria_num,event:{key:"criteria_comment",value:t.target.value}})}},null,8,["id","name","value","rules","disabled","onInput"])])])}),128))])]))}}),ge={class:"datatable"},ke={key:0,class:"question"},Se={key:1,class:"description"},Ce={class:"standardtable center no-v-line"},we=i("thead",null,[i("tr",null,[i("th",{style:{width:"20%"}},[i("div",{class:"flex flex-col"},[i("div",{class:""},"Peer"),i("small",{class:"small"})])]),i("th",{style:{width:"80%"}},[i("div",{class:"flex flex-col"},[i("div",{class:""},"General Comments"),i("small",{class:"small"})])])])],-1),Ie=N({__name:"PeerRubricGeneralCommentQuestion",props:{index:null,members:null,initialState:null,disabled:{type:Boolean}},emits:["update:initialState"],setup(m,{emit:V}){const a=m,p=M();z(p.name==="submission.view");const l=W({question:{title:"Please provide overall comments about each peer.",description:""}});function o(n,_){const s=a.initialState;if(s){const e=y.exports.find(s==null?void 0:s.data,{evaluatee:_});if(e)return e[n]}}return(n,_)=>{var s,e;return u(),d("div",ge,[(s=l==null?void 0:l.question)!=null&&s.title?(u(),d("div",ke,C(a.index)+". "+C(l.question.title),1)):Q("",!0),(e=l==null?void 0:l.question)!=null&&e.description?(u(),d("div",Se,C(l.question.description),1)):Q("",!0),i("table",Ce,[we,i("tbody",null,[(u(!0),d(R,null,E(a.members,(t,c)=>(u(),d("tr",{key:t.id},[i("td",null,[v(O,{member:t},null,8,["member"])]),i("td",null,[v(Y,{name:`${t.id}gen_comment`,value:o("comment",t.id),rules:r(X),disabled:a.disabled,onInput:b=>n.$emit("update:initialState",{member_id:t.id,criteria_num:"",event:{key:"comment",value:b.target.value}})},null,8,["name","value","rules","disabled","onInput"])])]))),128))])])])}}}),De={key:0,class:"question"},qe=i("div",{class:"description text-sm text-slate-700 mx-4 mb-2"},null,-1),Ne=N({__name:"RubricEvaluation",props:{members:null,currentUser:null,evaluation:null,isDisabled:{type:Boolean}},emits:["fetch:evaluation"],setup(m,{emit:V}){const a=m;M(),ee(),z(null);const p=T(a,"members"),l=T(a,"evaluation");let o=W({event_id:B(()=>{var e;return(e=l.value)==null?void 0:e.id}),group_id:B(()=>{var e,t;return(t=(e=l.value)==null?void 0:e.group)==null?void 0:t.id}),course_id:B(()=>{var e,t;return(t=(e=l.value)==null?void 0:e.course)==null?void 0:t.id}),group_event_id:B(()=>{var e;return(e=l.value)==null?void 0:e.group_event_id}),rubric_id:B(()=>{var e;return(e=l.value)==null?void 0:e.rubric_id}),user_id:B(()=>{var e;return(e=a.currentUser)==null?void 0:e.id}),evaluatee_count:B(()=>{var e;return(e=p.value)==null?void 0:e.length}),member_ids:B(()=>y.exports.map(p.value,e=>e.id))});const n=z({});function _(){var e;return{id:"",submitter_id:(e=a.currentUser)==null?void 0:e.id,submitted:null,date_submitted:"",data:y.exports.map(p.value,t=>{var c,b,f,x;return{evaluator:(c=a.currentUser)==null?void 0:c.id,evaluatee:t==null?void 0:t.id,comment:"",score:"",details:y.exports.map((x=(f=(b=l.value)==null?void 0:b.rubric)==null?void 0:f.data)==null?void 0:x.rubrics_criteria,h=>({criteria_number:h==null?void 0:h.criteria_num,criteria_comment:"",selected_lom:""}))}})}}function s(e){var c,b,f,x;const t=y.exports.isEmpty(n.value)?{}:(c=n.value)==null?void 0:c.data;if(t){const h=y.exports.find(t,{evaluatee:e==null?void 0:e.member_id});if(h)if(((b=e==null?void 0:e.event)==null?void 0:b.key)==="comment")h.comment=(f=e==null?void 0:e.event)==null?void 0:f.value;else{const P=y.exports.find(h==null?void 0:h.details,{criteria_number:e.criteria_num});P&&(P[e.event.key]=(x=e.event)==null?void 0:x.value)}}}return te(()=>{var t,c;const e=_();((t=l.value)==null?void 0:t.response)&&!y.exports.isEmpty(l.value.response)?n.value=Object.assign(e,r((c=l.value)==null?void 0:c.response)):n.value=e}),(e,t)=>(u(),F(re,{onSubmit:e.onSubmit,"initial-state":n.value,evaluation:r(l),"onSet:message":t[0]||(t[0]=c=>e.$emit("set:message",e.message))},{default:ie(({onSave:c,errors:b,values:f,isSubmitting:x,evaluationRef:h,message:P,autosave:j})=>[L(e.$slots,"header",{},()=>{var w,I,D,q,g,$,U,k;return[v(r(S),{type:"hidden",name:"event_id",value:(w=r(o))==null?void 0:w.event_id},null,8,["value"]),v(r(S),{type:"hidden",name:"group_id",value:(I=r(o))==null?void 0:I.group_id},null,8,["value"]),v(r(S),{type:"hidden",name:"group_event_id",value:(D=r(o))==null?void 0:D.group_event_id},null,8,["value"]),v(r(S),{type:"hidden",name:"course_id",value:(q=r(o))==null?void 0:q.course_id},null,8,["value"]),v(r(S),{type:"hidden",name:"rubric_id",value:(g=r(o))==null?void 0:g.rubric_id},null,8,["value"]),v(r(S),{type:"hidden",name:"data[Evaluation][evaluator_id]",value:($=r(o))==null?void 0:$.user_id},null,8,["value"]),v(r(S),{type:"hidden",name:"evaluateeCount",value:(U=r(o))==null?void 0:U.evaluatee_count},null,8,["value"]),(u(!0),d(R,null,E((k=r(o))==null?void 0:k.member_ids,(A,G)=>(u(),F(r(S),{type:"hidden",key:G,name:"memberIDs[]",value:A},null,8,["value"]))),128))]}),L(e.$slots,"main",{},()=>{var w,I,D,q,g,$,U;return[(u(!0),d(R,null,E((D=(I=(w=r(l))==null?void 0:w.rubric)==null?void 0:I.data)==null?void 0:D.rubrics_criteria,(k,A)=>{var G,H,J,K;return u(),d("div",{class:"datatable",key:k.id},[k.criteria?(u(),d("div",De,C(k.id)+". "+C(k.criteria),1)):Q("",!0),qe,v(pe,{members:r(p),"initial-state":n.value,rubric_criteria:k,rubrics_lom:(J=(H=(G=r(l))==null?void 0:G.rubric)==null?void 0:H.data)==null?void 0:J.rubrics_lom,disabled:a.isDisabled,autosave:j,"onUpdate:initialState":s},null,8,["members","initial-state","rubric_criteria","rubrics_lom","disabled","autosave"]),ae(v(xe,{members:r(p),"initial-state":n.value,rubric_criteria_idx:A,rubric_criteria:k,disabled:a.isDisabled,autosave:j,"onUpdate:initialState":s},null,8,["members","initial-state","rubric_criteria_idx","rubric_criteria","disabled","autosave"]),[[le,parseInt((K=r(l))==null?void 0:K.com_req)]])])}),128)),v(Ie,{index:((U=($=(g=(q=r(l))==null?void 0:q.rubric)==null?void 0:g.data)==null?void 0:$.rubrics_criteria)==null?void 0:U.length)+1,members:r(p),"initial-state":n.value,rubric_criteria_idx:e.criteriaIdx,disabled:a.isDisabled,"onUpdate:initialState":s},null,8,["index","members","initial-state","rubric_criteria_idx","disabled"])]}),L(e.$slots,"footer"),L(e.$slots,"cta",{onSave:c,isSubmitting:x,values:f})]),_:3},8,["onSubmit","initial-state","evaluation"]))}});export{Ne as default};
//# sourceMappingURL=RubricEvaluation.js.map
