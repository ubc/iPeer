import{d as F,T as ae,x as se,k as w,o as i,c as d,a,t as V,z as ne,q as s,A as le,g,v as X,n as ie,F as L,b as oe,j as R,s as Y,M as Z,L as J,e as D,p as y,G as ue,I as re,r as K,m as W,w as de,f as j}from"./main.js";import{l as q}from"./lodash.js";import{_ as P,a as ce}from"./EvaluationForm.vue_vue_type_script_setup_true_lang.js";import{_ as ee}from"./UserCard.vue_vue_type_script_setup_true_lang.js";import"./autosize.esm.js";import{a as me}from"./rules.js";import{_ as pe}from"./CustomTextField.vue_vue_type_script_setup_true_lang.js";import"./_commonjsHelpers.js";import"./index.js";const ve={class:"form-range form-range-inline flex flex-col"},_e={class:"form-range-label text-slate-500"},he=a("span",{class:"tick"},null,-1),be=["min","step","max","name","value","disabled"],fe={key:0,class:"flex justify-between items-center"},xe={key:0,class:"min text-sm text-slate-500 font-normal"},ye={key:1,class:"max text-sm text-slate-500 font-normal"},ge={key:0,class:"range-review extended"},$e={key:1,class:"range-review extended"},Se={class:"heat-gradient mx-12"},ke={class:"gradient"},we=["data-value"],qe=oe('<div class="axis"><span class="">1</span><span class="">2</span><span class="">3</span><span class="">4</span><span class="">5</span><span class="">6</span><span class="">7</span><span class="">8</span><span class="">9</span><span class="active">10</span></div>',1),Ve=F({__name:"CustomRangeField",props:{label:null,name:null,value:null,response:null,points:null,rules:null,disabled:{type:Boolean,default:!1},placeholder:{default:""},min:{default:0},step:{default:1},max:{default:100},text:{default:()=>["min","max"]},showScore:{type:Boolean},remaining:null,point_per_member:null},emits:["update:input"],setup(o,{emit:z}){const t=o,{name:n,value:u}=ae(t),{value:c,errorMessage:f,handleBlur:h,handleChange:e,meta:m}=se(n,t.rules,{initialValue:t.value,validateOnValueUpdate:!0}),S=w(()=>Number(c.value)),B={blur:e,change:e,input:p=>e(p,!!f.value)};return(p,v)=>(i(),d(L,null,[a("div",{class:X(["block block-slider",{"has-error":!!s(f),success:s(m).valid}])},[a("label",ve,[a("span",_e,V(t.label),1),he,a("input",ne({class:"form-range-input",type:"range",min:t.min,step:t.step,max:t.max,name:s(n),value:s(c),disabled:o.disabled},le(B,!0),{onInput:v[0]||(v[0]=_=>p.$emit("update:input",_)),onBlur:v[1]||(v[1]=(..._)=>s(h)&&s(h)(..._))}),null,16,be)]),t.text?(i(),d("div",fe,[t.text[0]?(i(),d("div",xe,V(t.text[0]),1)):g("",!0),t.text[1]?(i(),d("div",ye,V(t.text[1]),1)):g("",!0)])):g("",!0)],2),t.showScore?(i(),d("div",ge)):g("",!0),t.showScore?(i(),d("div",$e,[a("div",Se,[a("div",ke,[a("div",{class:"needle","data-value":s(S),style:ie(`left: calc(0% + ${s(S)}% - 2.25px)`)},null,12,we)]),qe])])):g("",!0)],64))}}),Be={class:"datatable"},Ce={key:0,class:"question"},Re={key:1,class:"description text-sm mx-4 mb-2"},Pe={class:"standardtable"},Me=a("th",{style:{width:"20%"}},[a("div",{class:"text-center leading-4"},[a("div",{class:"font-normal"},"Peer"),a("div",{class:"text-sm font-thin"})])],-1),Ue={style:{width:"80%"}},Ne={class:"text-center leading-4"},Ee={class:"font-normal"},je=a("div",{class:"text-sm font-thin"},null,-1),Fe={style:{width:"20%"}},Le={style:{width:"80%"}},ze=["name","value"],De={key:0,class:"text-sm text-red-400"},Ie=F({__name:"PeerSimpleRangeQuestion",props:{members:null,initialState:null,remaining:null,point_per_member:null,name:null,label:null,question:null,description:null,placeholder:null,disabled:{type:Boolean}},setup(o,{emit:z}){var B;const t=o,n=R(!1),u=Y(t,"initialState"),c=R((B=t.remaining)!=null?B:t.members.length*t.point_per_member),f=R([]),h=R(0),e=R([]);function m(p){const{target:v,key:_,value:l}=p,r=f.value[_];h.value+=parseInt(l)-r,h.value<=0?e.value=q.exports.map(e.value,()=>c.value/e.value.length):(f.value[_]=parseInt(l),e.value=q.exports.map(f.value,b=>Math.round(c.value*b/h.value))),S(),u.value.data.points=e.value}Z(()=>{var v,_,l;const p=(_=(v=u.value)==null?void 0:v.data)==null?void 0:_.points;if(p!=null&&p.length)e.value=[...p],f.value=q.exports.map(p,(r,b)=>{const $=parseInt(r)/c.value,x=100*$;return h.value+=x,x});else{const r=Math.round(c.value/t.members.length);f.value=q.exports.map(t.members,()=>r),h.value=r*((l=t.members)==null?void 0:l.length),e.value=q.exports.map(t.members,()=>c.value/t.members.length)}});function S(){const p=q.exports.reduce(e.value,(r,b)=>r+=b,0),v=c.value-p,_=v>0?Math.min(...e.value):Math.max(...e.value),l=q.exports.findIndex(e.value,r=>r===_);e.value[l]+=v}return(p,v)=>(i(),d("div",Be,[t.question?(i(),d("div",Ce,V(t.question),1)):g("",!0),t.description?(i(),d("div",Re,V(t.description),1)):g("",!0),a("table",Pe,[a("thead",null,[a("tr",null,[Me,a("th",Ue,[a("div",Ne,[a("div",Ee,[J("Relative C"),a("span",{onClick:v[0]||(v[0]=_=>n.value=!n.value)},"o"),J("ntribution")]),je])])])]),a("tbody",null,[(i(!0),d(L,null,D(t.members,(_,l)=>{var r,b,k,$,x,C,M,U,N,E,I,O,Q,A,T,G,H;return i(),d("tr",{key:_.id},[a("td",Fe,[y(ee,{member:_},null,8,["member"])]),a("td",Le,[a("input",{type:"hidden",name:`${o.name}[${l}]`,value:((r=s(u))==null?void 0:r.data)&&((b=s(u))==null?void 0:b.data[o.name])?(k=s(u))==null?void 0:k.data[o.name][l]:""},null,8,ze),y(s(Ve),{text:["Less","More"],label:"A fair amount",name:`percent[${l}]`,value:(x=($=s(u))==null?void 0:$.data)==null?void 0:x.points[l],response:(M=(C=s(u))==null?void 0:C.data)==null?void 0:M.points,points:((U=s(u))==null?void 0:U.data)&&((E=(N=s(u))==null?void 0:N.data)==null?void 0:E.points)?(O=(I=s(u))==null?void 0:I.data)==null?void 0:O.points[l]:"",placeholder:o.placeholder,disabled:t.disabled,remaining:o.remaining,point_per_member:o.point_per_member,showScore:n.value,"onUpdate:input":te=>m({target:o.name,key:l,value:te.target.value})},null,8,["name","value","response","points","placeholder","disabled","remaining","point_per_member","showScore","onUpdate:input"]),n.value?(i(),d("div",De,V(((Q=s(u))==null?void 0:Q.data)&&((T=(A=s(u))==null?void 0:A.data)==null?void 0:T.points)?(H=(G=s(u))==null?void 0:G.data)==null?void 0:H.points[l]:""),1)):g("",!0)])])}),128))])])]))}}),Oe={class:"datatable",id:"PeerSimpleRangeQuestion"},Qe={key:0,class:"question"},Ae={key:1,class:"description text-sm mx-4 mb-2"},Te={class:"standardtable"},Ge=a("thead",null,[a("tr",null,[a("th",{style:{width:"20%"}},[a("div",{class:"text-center leading-4"},[a("div",{class:"font-normal"},"Peer"),a("div",{class:"text-sm font-thin"})])]),a("th",{style:{width:"80%"}},[a("div",{class:"text-center leading-4"},[a("div",{class:"font-normal"},"Comments"),a("div",{class:"text-sm font-thin"})])])])],-1),He={style:{width:"20%"}},Je={style:{width:"80%"}},Ke=F({__name:"PeerSimpleCommentQuestion",props:{members:null,initialState:null,question:null,name:null,label:null,description:null,placeholder:null,disabled:{type:Boolean}},setup(o,{emit:z}){const t=o;return(n,u)=>(i(),d("div",Oe,[t.question?(i(),d("div",Qe,V(t.question),1)):g("",!0),t.description?(i(),d("div",Ae,V(t.description),1)):g("",!0),a("table",Te,[Ge,a("tbody",null,[(i(!0),d(L,null,D(t.members,(c,f)=>(i(),d("tr",{key:c.id},[a("td",He,[y(ee,{member:c},null,8,["member"])]),a("td",Je,[y(pe,{label:o.label,name:`${o.name}[${f}]`,rules:s(me),disabled:t.disabled},null,8,["label","name","rules","disabled"])])]))),128))])])]))}}),lt=F({__name:"SimpleEvaluation",props:{members:null,currentUser:null,evaluation:null,disabled:{type:Boolean}},emits:["fetch:evaluation"],setup(o,{emit:z}){const t=o;ue(),re(),R();const n=Y(t,"evaluation"),u=K({event_id:w(()=>{var e;return(e=n.value)==null?void 0:e.id}),group_id:w(()=>{var e,m;return(m=(e=n.value)==null?void 0:e.group)==null?void 0:m.id}),course_id:w(()=>{var e,m;return(m=(e=n.value)==null?void 0:e.course)==null?void 0:m.id}),group_event_id:w(()=>{var e;return(e=n.value)==null?void 0:e.group_event_id}),rubric_id:w(()=>{var e;return(e=n.value)==null?void 0:e.rubric_id}),user_id:w(()=>{var e;return(e=t.currentUser)==null?void 0:e.id}),evaluatee_count:w(()=>{var e,m;return(m=(e=n.value)==null?void 0:e.members)==null?void 0:m.length}),member_ids:w(()=>{var e;return q.exports.map((e=n.value)==null?void 0:e.members,m=>m.id)})}),c=R({});function f(){var e;return{id:"",submitter_id:(e=t.currentUser)==null?void 0:e.id,submitted:null,date_submitted:"",data:{points:[],comments:[]}}}const h=K({points:{title:"1. Please rate each peer's relative contribution.",description:""},comments:{title:"2. Please provide overall comments about each peer.",description:""}});return Z(()=>{var m,S,B;const e=f();((m=n.value)==null?void 0:m.response)&&!q.exports.isEmpty((S=n.value)==null?void 0:S.response)?c.value=Object.assign(e,s((B=n.value)==null?void 0:B.response)):c.value=e}),(e,m)=>(i(),W(ce,{onSubmit:e.onSubmit,"initial-state":c.value,evaluation:s(n)},{default:de(({onSave:S,errors:B,values:p,isSubmitting:v,evaluationRef:_,message:l})=>[j(e.$slots,"header",{},()=>{var r,b,k,$,x,C,M,U;return[y(s(P),{type:"hidden",name:"event_id",value:(r=s(n))==null?void 0:r.id},null,8,["value"]),y(s(P),{type:"hidden",name:"group_id",value:(k=(b=s(n))==null?void 0:b.group)==null?void 0:k.id},null,8,["value"]),y(s(P),{type:"hidden",name:"course_id",value:(x=($=s(n))==null?void 0:$.course)==null?void 0:x.id},null,8,["value"]),y(s(P),{type:"hidden",name:"data[Evaluation][evaluator_id]",value:(C=o.currentUser)==null?void 0:C.id},null,8,["value"]),y(s(P),{type:"hidden",name:"evaluateeCount",value:(U=(M=s(n))==null?void 0:M.members)==null?void 0:U.length},null,8,["value"]),(i(!0),d(L,null,D(u==null?void 0:u.member_ids,(N,E)=>(i(),W(s(P),{type:"hidden",name:"memberIDs[]",key:E,value:N},null,8,["value"]))),128))]}),j(e.$slots,"main",{},()=>{var r,b,k,$,x,C;return[l&&Object.keys(l).length>0?(i(),d("div",{key:0,class:X(`notification ${l==null?void 0:l.type}`)},V(l==null?void 0:l.message),3)):g("",!0),y(Ie,{members:(r=s(n))==null?void 0:r.members,remaining:(k=(b=s(n))==null?void 0:b.simple)==null?void 0:k.remaining,point_per_member:(x=($=s(n))==null?void 0:$.simple)==null?void 0:x.point_per_member,initialState:c.value,name:"points",question:h.points.title,description:h.points.description,disabled:o.disabled},null,8,["members","remaining","point_per_member","initialState","question","description","disabled"]),y(Ke,{members:(C=s(n))==null?void 0:C.members,initialState:c.value,name:"comments",question:h.comments.title,description:h.comments.description,disabled:o.disabled},null,8,["members","initialState","question","description","disabled"])]}),j(e.$slots,"footer"),j(e.$slots,"cta",{onSave:S,isSubmitting:v,values:p})]),_:3},8,["onSubmit","initial-state","evaluation"]))}});export{lt as default};
