import{d as Q,o as s,c as d,a,t as S,g as G,F as P,e as U,n as ee,m as F,p as v,q as o,G as M,j as L,r as X,I as te,s as W,k as E,M as ie,w as ae,f as N,N as le,O as re}from"./main.js";import{l as x}from"./lodash.js";import"./autosize.esm.js";import{_ as k,a as ne}from"./EvaluationForm.vue_vue_type_script_setup_true_lang.js";import{v as se,a as Y}from"./rules.js";import{_ as ue}from"./CustomRadioField.vue_vue_type_script_setup_true_lang.js";import{_ as O}from"./UserCard.vue_vue_type_script_setup_true_lang.js";import{_ as Z}from"./CustomTextField.vue_vue_type_script_setup_true_lang.js";import"./_commonjsHelpers.js";import"./index.js";const oe={class:"standardtable leftalignedtable"},de={style:{width:"20%"}},ce={class:"text-center leading-4"},me={class:"text-sm font-normal leading-4 mb-1"},_e={key:0,class:"text-sm font-thin"},ve={class:"text-center leading-4"},be={class:"font-normal"},fe={class:"text-sm font-thin"},pe=Q({__name:"PeerRubricLikertQuestion",props:{members:null,initialState:null,rubric_criteria:null,rubrics_lom:null,disabled:{type:Boolean}},emits:["update:initialState"],setup(m,{emit:V}){const i=m;function w(u,l,_){const n=x.exports.find(i.initialState.data,{evaluatee:l});return n?x.exports.filter(n==null?void 0:n.details,t=>{if(t.criteria_number===_)return t})[0]:""}function r(u){if(!i.disabled){const l=document.forms[0],_=`selected_lom_${u.key}_${u.target}`;l.querySelector(`input[name=${_}]`).setAttribute("value",u.value)}}return(u,l)=>{var _,n,e;return s(),d("table",oe,[a("thead",null,[a("tr",null,[a("th",de,[a("div",ce,[a("div",me,S((_=i.rubric_criteria)==null?void 0:_.criteria),1),parseInt((n=i.rubric_criteria)==null?void 0:n.show_marks)?(s(),d("div",_e,"("+S((e=i.rubric_criteria)==null?void 0:e.multiplier)+" marks)",1)):G("",!0)])]),(s(!0),d(P,null,U(i.rubrics_lom,(t,c)=>{var f,p;return s(),d("th",{style:ee("width: "+80/((f=i.rubrics_lom)==null?void 0:f.length)+"%"),key:t.id},[a("div",ve,[a("div",be,S(t.lom_comment),1),a("div",fe,S((p=i.rubric_criteria)==null?void 0:p.rubrics_criteria_comment[c].criteria_comment),1)])],4)}),128))])]),a("tbody",null,[(s(!0),d(P,null,U(i.members,(t,c)=>{var f,p,$,h;return s(),d(P,{key:t.id},[m.disabled?G("",!0):(s(),F(k,{key:0,name:`selected_lom_${t.id}_${(f=m.rubric_criteria)==null?void 0:f.id}`,value:(h=($=w("criteria_num",t.id,(p=m.rubric_criteria)==null?void 0:p.criteria_num))==null?void 0:$.selected_lom)!=null?h:""},null,8,["name","value"])),a("tr",null,[a("td",null,[v(O,{member:t},null,8,["member"])]),(s(!0),d(P,null,U(i.rubrics_lom,(b,D)=>{var I,C,q,B;return s(),d("td",{key:b.id},[v(ue,{ref_for:!0,ref:"selected_lom",member_id:t.id,criteria_num:(I=i.rubric_criteria)==null?void 0:I.criteria_num,name:`${t.id}criteria_points_${(C=m.rubric_criteria)==null?void 0:C.id}`,value:b.lom_num,rules:o(se),checked:(B=w("criteria_num",t.id,(q=m.rubric_criteria)==null?void 0:q.criteria_num))==null?void 0:B.selected_lom,disabled:i.disabled,onClick:g=>{var y;return r({target:(y=m.rubric_criteria)==null?void 0:y.id,key:t.id,value:g.target.value})},onInput:g=>{var y;return u.$emit("update:initialState",{member_id:t.id,criteria_num:(y=m.rubric_criteria)==null?void 0:y.criteria_num,event:{key:"selected_lom",value:g.target.value}})}},null,8,["member_id","criteria_num","name","value","rules","checked","disabled","onClick","onInput"])])}),128))])],64)}),128))])])}}}),he={class:"standardtable leftalignedtable"},xe=a("thead",null,[a("tr",null,[a("th",{style:{width:"20%"}},[a("div",{class:"flex flex-col text-center"},[a("div",{class:"leading-4 flex-1 font-medium"},"Peer"),a("small",{class:"text-sm leading-4 flex-1 font-normal"})])]),a("th",{style:{width:"80%"}},[a("div",{class:"flex flex-col text-center"},[a("div",{class:"flex-1 font-medium"},"Comments"),a("small",{class:"flex-1 text-sm font-normal"})])])])],-1),ye={style:{width:"20%"}},$e={style:{width:"80%"}},ge={class:"flex flex-col"},ke=Q({__name:"PeerRubricCommentQuestion",props:{members:null,initialState:null,rubric_criteria_idx:null,rubric_criteria:null,disabled:{type:Boolean}},emits:["update:initialState"],setup(m,{emit:V}){const i=m;M();function w(r,u,l){const _=x.exports.find(i.initialState.data,{evaluatee:u});return _?x.exports.filter(_==null?void 0:_.details,e=>{if(e.criteria_number===l)return e})[0]:""}return(r,u)=>(s(),d("table",he,[xe,a("tbody",null,[(s(!0),d(P,null,U(i.members,(l,_)=>{var n,e;return s(),d("tr",{key:l.id},[a("td",ye,[v(O,{member:l},null,8,["member"])]),a("td",$e,[a("div",ge,[v(Z,{id:`${l.id}comments[${(n=m.rubric_criteria)==null?void 0:n.id}]`,name:`${l.id}comments[${i.rubric_criteria_idx}]`,value:w("criteria_comment",l.id,(e=m.rubric_criteria)==null?void 0:e.criteria_num).criteria_comment,rules:o(Y),disabled:i.disabled,onInput:t=>{var c;return r.$emit("update:initialState",{member_id:l.id,criteria_num:(c=m.rubric_criteria)==null?void 0:c.criteria_num,event:{key:"criteria_comment",value:t.target.value}})}},null,8,["id","name","value","rules","disabled","onInput"])])])])}),128))])]))}}),Se={class:"datatable"},we={key:0,class:"question text-base text-slate-900 tracking-wide"},Ie={key:1,class:"description text-sm text-slate-700 ml-5 mb-2 tracking-wider"},Ce={class:"standardtable leftalignedtable"},qe=a("thead",null,[a("tr",null,[a("th",{style:{width:"20%"}},[a("div",{class:"flex flex-col text-center"},[a("div",{class:"leading-4 flex-1 font-medium"},"Peer"),a("small",{class:"text-sm leading-4 flex-1 font-normal"})])]),a("th",{style:{width:"80%"}},[a("div",{class:"flex flex-col text-center"},[a("div",{class:"flex-1 font-medium"},"General Comments"),a("small",{class:"flex-1 text-sm font-normal"})])])])],-1),Be=Q({__name:"PeerRubricGeneralCommentQuestion",props:{index:null,members:null,initialState:null,disabled:{type:Boolean}},emits:["update:initialState"],setup(m,{emit:V}){const i=m,w=M();L(w.name==="submission.view");const r=X({question:{title:"Please provide overall comments about each peer.",description:""}});function u(l,_){const n=i.initialState;if(n){const e=x.exports.find(n==null?void 0:n.data,{evaluatee:_});if(e)return e[l]}}return(l,_)=>{var n,e;return s(),d("div",Se,[(n=r==null?void 0:r.question)!=null&&n.title?(s(),d("div",we,S(i.index)+". "+S(r.question.title),1)):G("",!0),(e=r==null?void 0:r.question)!=null&&e.description?(s(),d("div",Ie,S(r.question.description),1)):G("",!0),a("table",Ce,[qe,a("tbody",null,[(s(!0),d(P,null,U(i.members,(t,c)=>(s(),d("tr",{key:t.id},[a("td",null,[v(O,{member:t},null,8,["member"])]),a("td",null,[v(Z,{name:`${t.id}gen_comment`,value:u("comment",t.id),rules:o(Y),disabled:i.disabled,onInput:f=>l.$emit("update:initialState",{member_id:t.id,criteria_num:"",event:{key:"comment",value:f.target.value}})},null,8,["name","value","rules","disabled","onInput"])])]))),128))])])])}}}),Re={key:0,class:"question"},Ee=a("div",{class:"description text-sm text-slate-700 mx-4 mb-2"},null,-1),Me=Q({__name:"RubricEvaluation",props:{members:null,currentUser:null,evaluation:null,disabled:{type:Boolean}},emits:["fetch:evaluation"],setup(m,{emit:V}){const i=m,w=M();te(),L(w.name==="submission.view"),L(null),W(i,"members");const r=W(i,"evaluation");let u=X({event_id:E(()=>{var e;return(e=r.value)==null?void 0:e.id}),group_id:E(()=>{var e,t;return(t=(e=r.value)==null?void 0:e.group)==null?void 0:t.id}),course_id:E(()=>{var e,t;return(t=(e=r.value)==null?void 0:e.course)==null?void 0:t.id}),group_event_id:E(()=>{var e;return(e=r.value)==null?void 0:e.group_event_id}),rubric_id:E(()=>{var e;return(e=r.value)==null?void 0:e.rubric_id}),user_id:E(()=>{var e;return(e=i.currentUser)==null?void 0:e.id}),evaluatee_count:E(()=>{var e,t;return(t=(e=r.value)==null?void 0:e.members)==null?void 0:t.length}),member_ids:E(()=>{var e;return x.exports.map((e=r.value)==null?void 0:e.members,t=>t.id)})});const l=L({});function _(){var e,t;return{id:"",submitter_id:(e=i.currentUser)==null?void 0:e.id,submitted:null,date_submitted:"",data:x.exports.map((t=i.evaluation)==null?void 0:t.members,c=>{var f,p,$,h;return{evaluator:(f=i.currentUser)==null?void 0:f.id,evaluatee:c==null?void 0:c.id,comment:"",score:"",details:x.exports.map((h=($=(p=r.value)==null?void 0:p.rubric)==null?void 0:$.data)==null?void 0:h.rubrics_criteria,b=>({criteria_number:b==null?void 0:b.criteria_num,criteria_comment:"",selected_lom:""}))}})}}function n(e){var c,f,p,$;const t=x.exports.isEmpty(l.value)?{}:(c=l.value)==null?void 0:c.data;if(t){const h=x.exports.find(t,{evaluatee:e==null?void 0:e.member_id});if(h)if(((f=e==null?void 0:e.event)==null?void 0:f.key)==="comment")h.comment=(p=e==null?void 0:e.event)==null?void 0:p.value;else{const b=x.exports.find(h==null?void 0:h.details,{criteria_number:e.criteria_num});b&&(b[e.event.key]=($=e.event)==null?void 0:$.value)}}}return ie(()=>{var t,c;const e=_();((t=r.value)==null?void 0:t.response)&&!x.exports.isEmpty(r.value.response)?l.value=Object.assign(e,o((c=r.value)==null?void 0:c.response)):l.value=e}),(e,t)=>(s(),F(ne,{onSubmit:e.onSubmit,"initial-state":l.value,evaluation:i.evaluation},{default:ae(({onSave:c,errors:f,values:p,isSubmitting:$,evaluationRef:h})=>[N(e.$slots,"header",{},()=>{var b,D,I,C,q,B,g,y;return[v(o(k),{type:"hidden",name:"event_id",value:(b=o(u))==null?void 0:b.event_id},null,8,["value"]),v(o(k),{type:"hidden",name:"group_id",value:(D=o(u))==null?void 0:D.group_id},null,8,["value"]),v(o(k),{type:"hidden",name:"group_event_id",value:(I=o(u))==null?void 0:I.group_event_id},null,8,["value"]),v(o(k),{type:"hidden",name:"course_id",value:(C=o(u))==null?void 0:C.course_id},null,8,["value"]),v(o(k),{type:"hidden",name:"rubric_id",value:(q=o(u))==null?void 0:q.rubric_id},null,8,["value"]),v(o(k),{type:"hidden",name:"data[Evaluation][evaluator_id]",value:(B=o(u))==null?void 0:B.user_id},null,8,["value"]),v(o(k),{type:"hidden",name:"evaluateeCount",value:(g=o(u))==null?void 0:g.evaluatee_count},null,8,["value"]),(s(!0),d(P,null,U((y=o(u))==null?void 0:y.member_ids,(R,j)=>(s(),F(o(k),{type:"hidden",key:j,name:"memberIDs[]",value:R},null,8,["value"]))),128))]}),N(e.$slots,"main",{},()=>{var b,D,I,C,q,B,g,y;return[(s(!0),d(P,null,U((I=(D=(b=i.evaluation)==null?void 0:b.rubric)==null?void 0:D.data)==null?void 0:I.rubrics_criteria,(R,j)=>{var z,A,H,J,K,T;return s(),d("div",{class:"datatable",key:R.id},[R.criteria?(s(),d("div",Re,S(R.id)+". "+S(R.criteria),1)):G("",!0),Ee,v(pe,{members:(z=i.evaluation)==null?void 0:z.members,"initial-state":l.value,rubric_criteria:R,rubrics_lom:(J=(H=(A=i.evaluation)==null?void 0:A.rubric)==null?void 0:H.data)==null?void 0:J.rubrics_lom,disabled:i.disabled,"onUpdate:initialState":n},null,8,["members","initial-state","rubric_criteria","rubrics_lom","disabled"]),le(v(ke,{members:(K=i.evaluation)==null?void 0:K.members,"initial-state":l.value,rubric_criteria_idx:j,rubric_criteria:R,disabled:i.disabled,"onUpdate:initialState":n},null,8,["members","initial-state","rubric_criteria_idx","rubric_criteria","disabled"]),[[re,parseInt((T=i.evaluation)==null?void 0:T.com_req)]])])}),128)),v(Be,{index:((g=(B=(q=(C=i.evaluation)==null?void 0:C.rubric)==null?void 0:q.data)==null?void 0:B.rubrics_criteria)==null?void 0:g.length)+1,members:(y=i.evaluation)==null?void 0:y.members,"initial-state":l.value,rubric_criteria_idx:e.criteriaIdx,disabled:i.disabled,"onUpdate:initialState":n},null,8,["index","members","initial-state","rubric_criteria_idx","disabled"])]}),N(e.$slots,"footer"),N(e.$slots,"cta",{onSave:c,isSubmitting:$,values:p})]),_:3},8,["onSubmit","initial-state","evaluation"]))}});export{Me as default};
