{"version":3,"file":"EvaluationForm.js","sources":["../../../../vue-ts-ipeer/src/student/views/EvaluationForm.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { ref, computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useForm } from 'vee-validate'\nimport swal from 'sweetalert'\nimport useFetch from '@/composables/useFetch'\n\nimport { jsonToFormData } from '@/helpers'\nimport Debugger from '@/components/Debugger.vue'\n\nimport type {Evaluation, EvaluationReviewResponse} from '@/types/typings'\n\ninterface Props {\n  initialState: EvaluationReviewResponse\n  evaluation: Evaluation\n}\n// REFERENCES\nconst emit = defineEmits<{\n  (e: 'submit', option: any): void\n  (e: 'save', option: any): void\n}>()\nconst props = defineProps<Props>()\nconst router = useRouter()\nconst { values, errors, meta, handleSubmit, isSubmitting } = useForm({\n  initialValues: props.initialState?.data,\n})\n// DATA\nconst evaluation_form = ref()\n// COMPUTED\n// METHODS\nfunction onInvalidateSubmit({ errors }) {\n  const fieldName = Object.keys(errors)[0]\n  const fieldElement = document.getElementById(fieldName)\n  fieldElement?.focus?.()\n  fieldElement?.scrollIntoView({ behavior: 'smooth' })\n}\n\n/** TBD */\nconst _onSubmit = handleSubmit(() => {\n  emit('submit', values)\n}, onInvalidateSubmit)\n\nconst onSubmit = handleSubmit(async () => {\n  const formData = new FormData(evaluation_form.value)\n  formData.append('_method', 'POST')\n  const searchParams = new URLSearchParams()\n  for (const pair of formData) {\n    searchParams.append(pair[0], pair[1])\n  }\n  const response = await useFetch(`/evaluations/makeEvaluation/${props.evaluation?.id}/${props.evaluation?.group?.id}`, {\n    method: 'POST',\n    timeout: 300,\n    body: searchParams\n  })\n  await swal({text: response.message, icon: response.statusText})\n  if(response.status === 200) {\n    await router.push({ name: 'dashboard' })\n  }\n}, onInvalidateSubmit)\n\n\nasync function onSave() {\n  try {\n    const formData = new FormData(evaluation_form.value)\n    formData.append('_method', 'PUT')\n    const searchParams = new URLSearchParams()\n    for (const pair of formData) {\n      searchParams.append(pair[0], pair[1])\n    }\n    const response = await useFetch(`/evaluations/makeEvaluation/${props.evaluation?.id}/${props.evaluation?.group?.id}`, {\n      method: 'POST',\n      timeout: 300,\n      body: searchParams\n    })\n    await swal({text: response.message, icon: response.statusText})\n  } catch (err) {\n    await swal({text: 'something went wrong...', icon: 'error'})\n  }\n}\n// WATCH\n// LIFECYCLE\n</script>\n\n<template>\n  <form @submit.prevent=\"onSubmit\" ref=\"evaluation_form\" id=\"evaluation_form\" class=\"evaluation-form\">\n    <slot :evaluation-ref=\"evaluationRef\" :onSave=\"onSave\" :isSubmitting=\"isSubmitting\" :errors=\"errors\" :values=\"values\" />\n  </form>\n  <Debugger class=\"text-sm\" :state=\"values\" />\n</template>\n"],"names":["router","useRouter","values","errors","meta","handleSubmit","isSubmitting","useForm","_a","props","evaluation_form","ref","onInvalidateSubmit","fieldName","fieldElement","emit","onSubmit","formData","searchParams","pair","response","useFetch","_c","_b","swal","onSave"],"mappings":"oYAsBMA,EAASC,IACT,CAAE,OAAAC,EAAQ,OAAAC,EAAQ,KAAAC,EAAM,aAAAC,EAAc,aAAAC,GAAiBC,EAAQ,CACnE,eAAeC,EAAAC,EAAM,eAAN,YAAAD,EAAoB,IAAA,CACpC,EAEKE,EAAkBC,IAGxB,SAASC,EAAmB,CAAE,OAAAT,GAAU,OACtC,MAAMU,EAAY,OAAO,KAAKV,CAAM,EAAE,GAChCW,EAAe,SAAS,eAAeD,CAAS,GACtDL,EAAAM,GAAA,YAAAA,EAAc,QAAd,MAAAN,EAAA,KAAAM,GACAA,GAAA,MAAAA,EAAc,eAAe,CAAE,SAAU,QAAU,EACrD,CAGkBT,EAAa,IAAM,CACnCU,EAAK,SAAUb,CAAM,GACpBU,CAAkB,EAEf,MAAAI,EAAWX,EAAa,SAAY,WACxC,MAAMY,EAAW,IAAI,SAASP,EAAgB,KAAK,EAC1CO,EAAA,OAAO,UAAW,MAAM,EAC3B,MAAAC,EAAe,IAAI,gBACzB,UAAWC,KAAQF,EACjBC,EAAa,OAAOC,EAAK,GAAIA,EAAK,EAAE,EAEhC,MAAAC,EAAW,MAAMC,EAAS,gCAA+Bb,EAAAC,EAAM,aAAN,YAAAD,EAAkB,OAAMc,GAAAC,EAAAd,EAAM,aAAN,YAAAc,EAAkB,QAAlB,YAAAD,EAAyB,KAAM,CACpH,OAAQ,OACR,QAAS,IACT,KAAMJ,CAAA,CACP,EACK,MAAAM,EAAK,CAAC,KAAMJ,EAAS,QAAS,KAAMA,EAAS,WAAW,EAC3DA,EAAS,SAAW,KACrB,MAAMpB,EAAO,KAAK,CAAE,KAAM,WAAa,CAAA,GAExCY,CAAkB,EAGrB,eAAea,GAAS,WAClB,GAAA,CACF,MAAMR,EAAW,IAAI,SAASP,EAAgB,KAAK,EAC1CO,EAAA,OAAO,UAAW,KAAK,EAC1B,MAAAC,EAAe,IAAI,gBACzB,UAAWC,KAAQF,EACjBC,EAAa,OAAOC,EAAK,GAAIA,EAAK,EAAE,EAEhC,MAAAC,EAAW,MAAMC,EAAS,gCAA+Bb,EAAAC,EAAM,aAAN,YAAAD,EAAkB,OAAMc,GAAAC,EAAAd,EAAM,aAAN,YAAAc,EAAkB,QAAlB,YAAAD,EAAyB,KAAM,CACpH,OAAQ,OACR,QAAS,IACT,KAAMJ,CAAA,CACP,EACK,MAAAM,EAAK,CAAC,KAAMJ,EAAS,QAAS,KAAMA,EAAS,WAAW,QAE9D,MAAMI,EAAK,CAAC,KAAM,0BAA2B,KAAM,QAAQ,CAC7D,CACF"}