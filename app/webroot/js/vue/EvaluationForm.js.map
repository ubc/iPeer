{"version":3,"file":"EvaluationForm.js","sources":["../../../../vue-ts-ipeer/src/components/fields/CustomHiddenField.vue","../../../../vue-ts-ipeer/src/components/Debugger.vue","../../../../vue-ts-ipeer/src/student/views/EvaluationForm.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { toRef } from 'vue';\nimport { useField } from 'vee-validate';\n\nconst props = defineProps<{\n  name: string,\n  value: string,\n  modelValue: string|number\n}>();\n\nconst name = toRef(props, 'name');\nconst { checked, handleChange } = useField(name, undefined, {\n  type: 'hidden',\n  checkedValue: props.value,\n});\n</script>\n\n<template>\n  <input type=\"hidden\" :name=\"name\" :value=\"props.value\" :checked=\"checked\" />\n</template>\n","<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport config from 'envConfig'\n\ninterface Props {\n  title: string\n  state?: object\n  form?: object\n  data?: object\n}\n// REFERENCES\nconst props = defineProps<Props>()\n// DATA\nconst debug = ref(false)\n// METHODS\nfunction onDebug() {debug.value = !debug.value}\n</script>\n\n<template>\n  <div class=\"debugger\">\n    <div class=\"flex justify-between items-center\">\n      <h3 class=\"text-teal-600 font-medium\">{{ title }}</h3>\n      <button @click=\"onDebug\">{{ debug ? 'Hide' : 'Show' }}</button>\n    </div>\n    <hr/>\n    <div class=\"flex justify-evenly space-x-4\" v-show=\"debug\">\n      <pre v-if=\"state\" class=\"debug code flex-1 break-normal break-words break-all overflow-x\"><code>{{ JSON.stringify(state, null, 2) }}</code></pre>\n      <pre v-if=\"form\" class=\"debug code flex-1 break-normal break-words break-all overflow-x\"><code>{{ JSON.stringify(form, null, 2) }}</code></pre>\n      <pre v-if=\"data\" class=\"debug code flex-1 break-normal break-words break-all overflow-x\"><code>{{ JSON.stringify(data, null, 2) }}</code></pre>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n  pre {\n    @apply break-words;\n  }\n  code {\n    white-space: pre-wrap;\n    padding: 1px 5px;\n  }\n  .debug, .debugger, .preview {\n    //display: none;\n  }\n  .preview {\n    @apply text-sm flex justify-center text-slate-500 bg-slate-100;\n  }\n  .debug {\n    @apply border shadow py-2 px-4 my-4;\n    &.code {\n      @apply bg-gray-50 text-sm font-light text-slate-500;\n    }\n  }\n</style>\n","<script lang=\"ts\" setup>\nimport { ref, computed, watch } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useForm } from 'vee-validate'\nimport { cloneDeep, debounce } from 'lodash'\nimport useFetch from '@/composables/useFetch'\nimport swal from 'sweetalert'\nimport Debugger from \"@/components/Debugger.vue\";\n\nimport type {Evaluation, MixedResponse, RubricResponse, SimpleResponse} from '@/types/typings'\ninterface Props {\n  evaluation: Evaluation\n  initialState: SimpleResponse | RubricResponse | MixedResponse\n}\n// REFERENCES\nconst emit = defineEmits<{\n  (e: 'submit', option: any): void\n  (e: 'save', option: any): void\n}>()\nconst props = defineProps<Props>()\nconst router = useRouter()\nconst { values, errors, meta, handleSubmit, isSubmitting } = useForm({\n  initialValues: props.initialState?.data,\n})\n// DATA\nconst mode            = ref(import.meta.env.MODE === 'development')\nconst debug           = ref(false)\nconst evaluation_form = ref()\n// COMPUTED\n// METHODS\nfunction onInvalidateSubmit({ errors }) {\n  const fieldName = Object.keys(errors)[0]\n  const fieldElement = document.getElementById(fieldName)\n  fieldElement?.focus?.()\n  fieldElement?.scrollIntoView({ behavior: 'smooth' })\n}\n\n/** TBD */\nconst _onSubmit = handleSubmit(() => {\n  emit('submit', values)\n}, onInvalidateSubmit)\n\nconst onSubmit = handleSubmit(async () => {\n  const formData = new FormData(evaluation_form.value)\n  formData.append('_method', 'POST')\n  const searchParams = new URLSearchParams()\n  for (const pair of formData) {\n    searchParams.append(pair[0], pair[1])\n  }\n  const response = await useFetch(`/evaluations/makeEvaluation/${props.evaluation?.id}/${props.evaluation?.group?.id}`, {\n    method: 'POST',\n    timeout: 300,\n    body: searchParams\n  })\n  await swal({text: response.message, icon: response.statusText})\n  if(response.status === 200) {\n    await router.push({ name: 'dashboard' })\n  }\n}, onInvalidateSubmit)\n\nasync function onSave() {\n  try {\n    const formData = new FormData(evaluation_form.value)\n    formData.append('_method', 'PUT')\n    const searchParams = new URLSearchParams()\n    for (const pair of formData) {\n      searchParams.append(pair[0], pair[1])\n    }\n    const response = await useFetch(`/evaluations/makeEvaluation/${props.evaluation?.id}/${props.evaluation?.group?.id}`, {\n      method: 'POST',\n      timeout: 300,\n      body: searchParams\n    })\n    // if(response.status === 200) {\n    //   await router.push({ name: 'dashboard' })\n    // }\n    await swal({text: response.message, icon: response.statusText})\n  } catch (err) {\n    await swal({text: 'something went wrong...', icon: 'error'})\n  }\n}\n// WATCH\nwatch(() => cloneDeep(props.initialState), debounce(async (current, previous) => {\n  try {\n    const formData = new FormData(evaluation_form.value)\n    formData.append('_method', 'PUT')\n    const searchParams = new URLSearchParams()\n    for (const pair of formData) {\n      searchParams.append(pair[0], pair[1])\n    }\n    const response = await useFetch(`/evaluations/makeEvaluation/${props.evaluation?.id}/${props.evaluation?.group?.id}`, {\n      method: 'POST',\n      timeout: 300,\n      body: searchParams\n    })\n    // TODO:: add notification component to replace swal\n    console.table(response.message, 'auto-saved every 5000ms!', )\n  } catch (err) {\n    // TODO:: add notification component to replace swal\n    console.warn('auto-save error.', err.message)\n  }\n}, 5000), { deep: true })\n// LIFECYCLE\n</script>\n\n<template>\n  <form novalidate @submit.prevent=\"onSubmit\" id=\"evaluation_form\" class=\"evaluation-form\" ref=\"evaluation_form\">\n    <slot :evaluation-ref=\"evaluation_form\" :onSave=\"onSave\" :is-submitting=\"isSubmitting\" :errors=\"errors\" :values=\"values\" :form-meta=\"meta\" />\n  </form>\n\n  <button v-if=\"mode\" class=\"debugger button default\" @click=\"debug=!debug\">{{ debug ? 'Hide' : 'Show'}} Debugger</button>\n  <div v-if=\"debug\">\n    <Debugger title=\"Form Values/Errors\" :state=\"values\" :form=\"errors\" />\n    <Debugger title=\"InitialState\" :state=\"props.initialState\" />\n    <Debugger title=\"Evaluation\" :state=\"evaluation\" />\n    <Debugger title=\"Review\" :state=\"evaluation?.review\" />\n    <Debugger title=\"Response\" :state=\"evaluation?.response\" />\n  </div>\n</template>\n"],"names":["name","toRef","props","checked","handleChange","useField","debug","ref","onDebug","router","useRouter","values","errors","meta","handleSubmit","isSubmitting","useForm","_a","mode","evaluation_form","onInvalidateSubmit","fieldName","fieldElement","emit","onSubmit","formData","searchParams","pair","response","useFetch","_c","_b","swal","onSave","watch","cloneDeep","debounce","current","previous","err"],"mappings":"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"}