import{d as F,T as te,x as ae,k as w,o,c,a,t as B,z as se,q as s,A as ne,g as $,v as le,n as ie,F as L,b as oe,j as C,s as X,M as Y,L as J,e as z,p as x,G as re,I as ue,r as K,m as W,w as de,f as E}from"./main.js";import{l as q}from"./lodash.js";import{_ as R,a as me}from"./EvaluationForm.vue_vue_type_script_setup_true_lang.js";import{_ as Z}from"./UserCard.vue_vue_type_script_setup_true_lang.js";import"./autosize.esm.js";import{a as ce}from"./rules.js";import{_ as pe}from"./CustomTextField.vue_vue_type_script_setup_true_lang.js";import"./_commonjsHelpers.js";import"./sweetalert.min.js";import"./index2.js";const ve={class:"form-range form-range-inline flex flex-col"},_e={class:"form-range-label text-slate-500"},he=a("span",{class:"tick"},null,-1),be=["min","step","max","name","value","disabled"],fe={key:0,class:"flex justify-between items-center"},ge={key:0,class:"min text-sm text-slate-500 font-normal"},xe={key:1,class:"max text-sm text-slate-500 font-normal"},ye={key:0,class:"range-review extended"},$e={key:1,class:"range-review extended"},Se={class:"heat-gradient mx-12"},ke={class:"gradient"},we=["data-value"],qe=oe('<div class="axis"><span class="">1</span><span class="">2</span><span class="">3</span><span class="">4</span><span class="">5</span><span class="">6</span><span class="">7</span><span class="">8</span><span class="">9</span><span class="active">10</span></div>',1),Ve=F({__name:"CustomRangeField",props:{label:null,name:null,value:null,response:null,points:null,rules:null,disabled:{type:Boolean,default:!1},placeholder:{default:""},min:{default:0},step:{default:1},max:{default:100},text:{default:()=>["min","max"]},showScore:{type:Boolean},remaining:null,point_per_member:null},emits:["update:input"],setup(i,{emit:j}){const t=i,{name:n,value:r}=te(t),{value:d,errorMessage:f,handleBlur:h,handleChange:e,meta:m}=ae(n,t.rules,{initialValue:t.value,validateOnValueUpdate:!0}),S=w(()=>Number(d.value)),V={blur:e,change:e,input:p=>e(p,!!f.value)};return(p,v)=>(o(),c(L,null,[a("div",{class:le(["block block-slider",{"has-error":!!s(f),success:s(m).valid}])},[a("label",ve,[a("span",_e,B(t.label),1),he,a("input",se({class:"form-range-input",type:"range",min:t.min,step:t.step,max:t.max,name:s(n),value:s(d),disabled:i.disabled},ne(V,!0),{onInput:v[0]||(v[0]=_=>p.$emit("update:input",_)),onBlur:v[1]||(v[1]=(..._)=>s(h)&&s(h)(..._))}),null,16,be)]),t.text?(o(),c("div",fe,[t.text[0]?(o(),c("div",ge,B(t.text[0]),1)):$("",!0),t.text[1]?(o(),c("div",xe,B(t.text[1]),1)):$("",!0)])):$("",!0)],2),t.showScore?(o(),c("div",ye)):$("",!0),t.showScore?(o(),c("div",$e,[a("div",Se,[a("div",ke,[a("div",{class:"needle","data-value":s(S),style:ie(`left: calc(0% + ${s(S)}% - 2.25px)`)},null,12,we)]),qe])])):$("",!0)],64))}}),Be={class:"datatable"},Ce={key:0,class:"question"},Re={key:1,class:"description text-sm mx-4 mb-2"},Pe={class:"standardtable"},Me=a("th",{style:{width:"20%"}},[a("div",{class:"text-center leading-4"},[a("div",{class:"font-normal"},"Peer"),a("div",{class:"text-sm font-thin"})])],-1),Ue={style:{width:"80%"}},Ne={class:"text-center leading-4"},Ee={class:"font-normal"},Fe=a("div",{class:"text-sm font-thin"},null,-1),Le={style:{width:"20%"}},je={style:{width:"80%"}},ze=["name","value"],De={key:0,class:"text-sm text-red-400"},Ie=F({__name:"PeerSimpleRangeQuestion",props:{members:null,initialState:null,remaining:null,point_per_member:null,name:null,label:null,question:null,description:null,placeholder:null,disabled:{type:Boolean}},setup(i,{emit:j}){var V;const t=i,n=C(!1),r=X(t,"initialState"),d=C((V=t.remaining)!=null?V:t.members.length*t.point_per_member),f=C([]),h=C(0),e=C([]);function m(p){const{target:v,key:_,value:l}=p,u=f.value[_];h.value+=parseInt(l)-u,h.value<=0?e.value=q.exports.map(e.value,()=>d.value/e.value.length):(f.value[_]=parseInt(l),e.value=q.exports.map(f.value,b=>Math.round(d.value*b/h.value))),S(),r.value.data.points=e.value}Y(()=>{var v,_,l;const p=(_=(v=r.value)==null?void 0:v.data)==null?void 0:_.points;if(p!=null&&p.length)e.value=[...p],f.value=q.exports.map(p,(u,b)=>{const y=parseInt(u)/d.value,g=100*y;return h.value+=g,g});else{const u=Math.round(d.value/t.members.length);f.value=q.exports.map(t.members,()=>u),h.value=u*((l=t.members)==null?void 0:l.length),e.value=q.exports.map(t.members,()=>d.value/t.members.length)}});function S(){const p=q.exports.reduce(e.value,(u,b)=>u+=b,0),v=d.value-p,_=v>0?Math.min(...e.value):Math.max(...e.value),l=q.exports.findIndex(e.value,u=>u===_);e.value[l]+=v}return(p,v)=>(o(),c("div",Be,[t.question?(o(),c("div",Ce,B(t.question),1)):$("",!0),t.description?(o(),c("div",Re,B(t.description),1)):$("",!0),a("table",Pe,[a("thead",null,[a("tr",null,[Me,a("th",Ue,[a("div",Ne,[a("div",Ee,[J("Relative C"),a("span",{onClick:v[0]||(v[0]=_=>n.value=!n.value)},"o"),J("ntribution")]),Fe])])])]),a("tbody",null,[(o(!0),c(L,null,z(t.members,(_,l)=>{var u,b,k,y,g,P,M,U,N,D,I,Q,A,O,T,G,H;return o(),c("tr",{key:_.id},[a("td",Le,[x(Z,{member:_},null,8,["member"])]),a("td",je,[a("input",{type:"hidden",name:`${i.name}[${l}]`,value:((u=s(r))==null?void 0:u.data)&&((b=s(r))==null?void 0:b.data[i.name])?(k=s(r))==null?void 0:k.data[i.name][l]:""},null,8,ze),x(s(Ve),{text:["Less","More"],label:"A fair amount",name:`percent[${l}]`,value:(g=(y=s(r))==null?void 0:y.data)==null?void 0:g.points[l],response:(M=(P=s(r))==null?void 0:P.data)==null?void 0:M.points,points:((U=s(r))==null?void 0:U.data)&&((D=(N=s(r))==null?void 0:N.data)==null?void 0:D.points)?(Q=(I=s(r))==null?void 0:I.data)==null?void 0:Q.points[l]:"",placeholder:i.placeholder,disabled:t.disabled,remaining:i.remaining,point_per_member:i.point_per_member,showScore:n.value,"onUpdate:input":ee=>m({target:i.name,key:l,value:ee.target.value})},null,8,["name","value","response","points","placeholder","disabled","remaining","point_per_member","showScore","onUpdate:input"]),n.value?(o(),c("div",De,B(((A=s(r))==null?void 0:A.data)&&((T=(O=s(r))==null?void 0:O.data)==null?void 0:T.points)?(H=(G=s(r))==null?void 0:G.data)==null?void 0:H.points[l]:""),1)):$("",!0)])])}),128))])])]))}}),Qe={class:"datatable",id:"PeerSimpleRangeQuestion"},Ae={key:0,class:"question"},Oe={key:1,class:"description text-sm mx-4 mb-2"},Te={class:"standardtable"},Ge=a("thead",null,[a("tr",null,[a("th",{style:{width:"20%"}},[a("div",{class:"text-center leading-4"},[a("div",{class:"font-normal"},"Peer"),a("div",{class:"text-sm font-thin"})])]),a("th",{style:{width:"80%"}},[a("div",{class:"text-center leading-4"},[a("div",{class:"font-normal"},"Comments"),a("div",{class:"text-sm font-thin"})])])])],-1),He={style:{width:"20%"}},Je={style:{width:"80%"}},Ke=F({__name:"PeerSimpleCommentQuestion",props:{members:null,initialState:null,question:null,name:null,label:null,description:null,placeholder:null,disabled:{type:Boolean}},setup(i,{emit:j}){const t=i;return(n,r)=>(o(),c("div",Qe,[t.question?(o(),c("div",Ae,B(t.question),1)):$("",!0),t.description?(o(),c("div",Oe,B(t.description),1)):$("",!0),a("table",Te,[Ge,a("tbody",null,[(o(!0),c(L,null,z(t.members,(d,f)=>(o(),c("tr",{key:d.id},[a("td",He,[x(Z,{member:d},null,8,["member"])]),a("td",Je,[x(pe,{label:i.label,name:`${i.name}[${f}]`,rules:s(ce),disabled:t.disabled},null,8,["label","name","rules","disabled"])])]))),128))])])]))}}),it=F({__name:"SimpleEvaluation",props:{members:null,currentUser:null,evaluation:null,disabled:{type:Boolean}},emits:["fetch:evaluation"],setup(i,{emit:j}){const t=i;re(),ue(),C();const n=X(t,"evaluation"),r=K({event_id:w(()=>{var e;return(e=n.value)==null?void 0:e.id}),group_id:w(()=>{var e,m;return(m=(e=n.value)==null?void 0:e.group)==null?void 0:m.id}),course_id:w(()=>{var e,m;return(m=(e=n.value)==null?void 0:e.course)==null?void 0:m.id}),group_event_id:w(()=>{var e;return(e=n.value)==null?void 0:e.group_event_id}),rubric_id:w(()=>{var e;return(e=n.value)==null?void 0:e.rubric_id}),user_id:w(()=>{var e;return(e=t.currentUser)==null?void 0:e.id}),evaluatee_count:w(()=>{var e,m;return(m=(e=n.value)==null?void 0:e.members)==null?void 0:m.length}),member_ids:w(()=>{var e;return q.exports.map((e=n.value)==null?void 0:e.members,m=>m.id)})}),d=C({});function f(){var e;return{id:"",submitter_id:(e=t.currentUser)==null?void 0:e.id,submitted:null,date_submitted:"",data:{points:[],comments:[]}}}const h=K({points:{title:"1. Please rate each peer's relative contribution.",description:""},comments:{title:"2. Please provide overall comments about each peer.",description:""}});return Y(()=>{var m,S,V;const e=f();((m=n.value)==null?void 0:m.response)&&!q.exports.isEmpty((S=n.value)==null?void 0:S.response)?d.value=Object.assign(e,s((V=n.value)==null?void 0:V.response)):d.value=e}),(e,m)=>(o(),W(me,{onSubmit:e.onSubmit,"initial-state":d.value,evaluation:s(n)},{default:de(({onSave:S,errors:V,values:p,isSubmitting:v,evaluationRef:_})=>[E(e.$slots,"header",{},()=>{var l,u,b,k,y,g,P,M;return[x(s(R),{type:"hidden",name:"event_id",value:(l=s(n))==null?void 0:l.id},null,8,["value"]),x(s(R),{type:"hidden",name:"group_id",value:(b=(u=s(n))==null?void 0:u.group)==null?void 0:b.id},null,8,["value"]),x(s(R),{type:"hidden",name:"course_id",value:(y=(k=s(n))==null?void 0:k.course)==null?void 0:y.id},null,8,["value"]),x(s(R),{type:"hidden",name:"data[Evaluation][evaluator_id]",value:(g=i.currentUser)==null?void 0:g.id},null,8,["value"]),x(s(R),{type:"hidden",name:"evaluateeCount",value:(M=(P=s(n))==null?void 0:P.members)==null?void 0:M.length},null,8,["value"]),(o(!0),c(L,null,z(r==null?void 0:r.member_ids,(U,N)=>(o(),W(s(R),{type:"hidden",name:"memberIDs[]",key:N,value:U},null,8,["value"]))),128))]}),E(e.$slots,"main",{},()=>{var l,u,b,k,y,g;return[x(Ie,{members:(l=s(n))==null?void 0:l.members,remaining:(b=(u=s(n))==null?void 0:u.simple)==null?void 0:b.remaining,point_per_member:(y=(k=s(n))==null?void 0:k.simple)==null?void 0:y.point_per_member,initialState:d.value,name:"points",question:h.points.title,description:h.points.description,disabled:i.disabled},null,8,["members","remaining","point_per_member","initialState","question","description","disabled"]),x(Ke,{members:(g=s(n))==null?void 0:g.members,initialState:d.value,name:"comments",question:h.comments.title,description:h.comments.description,disabled:i.disabled},null,8,["members","initialState","question","description","disabled"])]}),E(e.$slots,"footer"),E(e.$slots,"cta",{onSave:S,isSubmitting:v,values:p})]),_:3},8,["onSubmit","initial-state","evaluation"]))}});export{it as default};
//# sourceMappingURL=SimpleEvaluation.js.map
