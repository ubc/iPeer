import{d as A,T as Z,x as ee,o as u,c as m,a as s,t as C,z as te,q as a,A as se,g as $,v as ae,_ as D,j as P,s as K,L as X,F as W,e as H,p as y,D as ie,H as ne,r as G,k as x,m as J,w as re,f as Q}from"./main.js";import{l as k}from"./lodash.js";import{C as U,E as le}from"./EvaluationForm.js";import{U as Y}from"./UserCard.js";import"./autosize.esm.js";import{a as ue}from"./rules.js";import{C as oe}from"./CustomTextField.js";import"./_commonjsHelpers.js";import"./sweetalert.min.js";import"./index2.js";const de={class:"form-range form-range-inline flex flex-col"},me={class:"form-range-label text-slate-500"},pe=s("span",{class:"tick"},null,-1),ce=["min","step","max","name","value","disabled"],ve={key:0,class:"flex justify-between items-center"},fe={key:0,class:"min text-sm text-slate-500 font-normal"},he={key:1,class:"max text-sm text-slate-500 font-normal"},be=A({__name:"CustomRangeField",props:{label:{type:String,required:!1},name:{type:String,required:!0},value:{type:String,required:!0},response:{type:Object,required:!0},points:{type:[String,Number],required:!0},rules:{type:String,required:!1},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default:""},min:{type:[String,Number],required:!1,default:0},step:{type:[String,Number],required:!1,default:1},max:{type:[String,Number],required:!1,default:100},text:{type:Array,required:!1,default:()=>["min","max"]}},emits:["update:input"],setup(p,{emit:L}){const e=p,{name:S,value:i}=Z(e),{value:f,errorMessage:o,handleBlur:_,handleChange:n,meta:R}=ee(S,e.rules,{initialValue:e.value,validateOnValueUpdate:!0}),t={blur:n,change:n,input:r=>n(r,!!o.value)};return(r,l)=>(u(),m("div",{class:ae(["block block-slider",{"has-error":!!a(o),success:a(R).valid}])},[s("label",de,[s("span",me,C(e.label),1),pe,s("input",te({class:"form-range-input",type:"range",min:e.min,step:e.step,max:e.max,name:a(S),value:a(f),disabled:p.disabled},se(t,!0),{onInput:l[0]||(l[0]=c=>r.$emit("update:input",c)),onBlur:l[1]||(l[1]=(...c)=>a(_)&&a(_)(...c))}),null,16,ce)]),e.text?(u(),m("div",ve,[e.text[0]?(u(),m("div",fe,C(e.text[0]),1)):$("v-if",!0),e.text[1]?(u(),m("div",he,C(e.text[1]),1)):$("v-if",!0)])):$("v-if",!0)],2))}}),_e=D(be,[["__file","/Users/josephkh/Workspace/iPeer/app/webroot/vue-ts-ipeer/src/components/fields/CustomRangeField.vue"]]),ye={class:"datatable"},ge={key:0,class:"question"},Se={key:1,class:"description text-sm mx-4 mb-2"},qe={class:"standardtable"},xe=s("thead",null,[s("tr",null,[s("th",{style:{width:"20%"}},[s("div",{class:"text-center leading-4"},[s("div",{class:"font-normal"},"Peer"),s("div",{class:"text-sm font-thin"})])]),s("th",{style:{width:"80%"}},[s("div",{class:"text-center leading-4"},[s("div",{class:"font-normal"},"Relative Contribution"),s("div",{class:"text-sm font-thin"})])])])],-1),ke={style:{width:"20%"}},$e={style:{width:"80%"}},we=["name","value"],Ce={key:0,class:"text-sm text-red-400"},Pe=A({__name:"PeerSimpleRangeQuestion",props:{members:{type:Array,required:!0},initialState:{type:null,required:!0},remaining:{type:[String,Number],required:!0},name:{type:String,required:!0},label:{type:String,required:!1},question:{type:String,required:!1},description:{type:String,required:!1},placeholder:{type:String,required:!1},disabled:{type:Boolean,required:!1}},setup(p,{emit:L}){var r;const e=p,S=P(!1),i=K(e,"initialState"),f=P((r=e.remaining)!=null?r:e.members.length*100),o=P([]),_=P(0),n=P([]);function R(l){const{target:c,key:b,value:d}=l,v=o.value[b];_.value+=parseInt(d)-v,_.value<=0?n.value=k.exports.map(n.value,()=>f.value/n.value.length):(o.value[b]=parseInt(d),n.value=k.exports.map(o.value,h=>Math.round(f.value*h/_.value))),t(),i.value.data.points=n.value}X(()=>{var c,b,d;const l=(b=(c=i.value)==null?void 0:c.data)==null?void 0:b.points;if(l!=null&&l.length)n.value=[...l],o.value=k.exports.map(l,(v,h)=>{const g=parseInt(v)/f.value,w=100*g;return _.value+=w,w});else{const v=Math.round(f.value/e.members.length);o.value=k.exports.map(e.members,()=>v),_.value=v*((d=e.members)==null?void 0:d.length),n.value=k.exports.map(e.members,()=>f.value/e.members.length)}});function t(){const l=k.exports.reduce(n.value,(v,h)=>v+=h,0),c=f.value-l,b=c>0?Math.min(...n.value):Math.max(...n.value),d=k.exports.findIndex(n.value,v=>v===b);n.value[d]+=c}return(l,c)=>(u(),m("div",ye,[e.question?(u(),m("div",ge,C(e.question),1)):$("v-if",!0),e.description?(u(),m("div",Se,C(e.description),1)):$("v-if",!0),s("table",qe,[xe,s("tbody",null,[(u(!0),m(W,null,H(e.members,(b,d)=>{var v,h,q,g,w,V,B,F,j,E,N,M,O,T,z;return u(),m("tr",{key:b.id},[s("td",ke,[y(Y,{member:b,onClick:c[0]||(c[0]=I=>S.value=!S.value)},null,8,["member"])]),s("td",$e,[s("input",{type:"hidden",name:`${p.name}[${d}]`,value:((v=a(i))==null?void 0:v.data)&&((h=a(i))==null?void 0:h.data[p.name])?(q=a(i))==null?void 0:q.data[p.name][d]:""},null,8,we),y(a(_e),{text:["Less","More"],label:"A fair amount",name:`percent[${d}]`,value:o.value[d],response:(w=(g=a(i))==null?void 0:g.data)==null?void 0:w.points,points:((V=a(i))==null?void 0:V.data)&&((F=(B=a(i))==null?void 0:B.data)==null?void 0:F.points)?(E=(j=a(i))==null?void 0:j.data)==null?void 0:E.points[d]:"",placeholder:p.placeholder,disabled:e.disabled,"onUpdate:input":I=>R({target:p.name,key:d,value:I.target.value})},null,8,["name","value","response","points","placeholder","disabled","onUpdate:input"]),S.value?(u(),m("div",Ce,C(((N=a(i))==null?void 0:N.data)&&((O=(M=a(i))==null?void 0:M.data)==null?void 0:O.points)?(z=(T=a(i))==null?void 0:T.data)==null?void 0:z.points[d]:""),1)):$("v-if",!0)])])}),128))])])]))}}),Re=D(Pe,[["__file","/Users/josephkh/Workspace/iPeer/app/webroot/vue-ts-ipeer/src/student/views/questions/PeerSimpleRangeQuestion.vue"]]),Ue={class:"datatable",id:"PeerSimpleRangeQuestion"},Ve={key:0,class:"question"},Be={key:1,class:"description text-sm mx-4 mb-2"},Fe={class:"standardtable"},je=s("thead",null,[s("tr",null,[s("th",{style:{width:"20%"}},[s("div",{class:"text-center leading-4"},[s("div",{class:"font-normal"},"Peer"),s("div",{class:"text-sm font-thin"})])]),s("th",{style:{width:"80%"}},[s("div",{class:"text-center leading-4"},[s("div",{class:"font-normal"},"Comments"),s("div",{class:"text-sm font-thin"})])])])],-1),Ee={style:{width:"20%"}},Ne={style:{width:"80%"}},Me=A({__name:"PeerSimpleCommentQuestion",props:{members:{type:Array,required:!0},initialState:{type:null,required:!0},name:{type:String,required:!0},label:{type:String,required:!1},question:{type:String,required:!1},description:{type:String,required:!1},placeholder:{type:String,required:!1},disabled:{type:Boolean,required:!1}},setup(p,{emit:L}){const e=p;return(S,i)=>(u(),m("div",Ue,[e.question?(u(),m("div",Ve,C(e.question),1)):$("v-if",!0),e.description?(u(),m("div",Be,C(e.description),1)):$("v-if",!0),s("table",Fe,[je,s("tbody",null,[(u(!0),m(W,null,H(e.members,(f,o)=>(u(),m("tr",{key:f.id},[s("td",Ee,[y(Y,{member:f},null,8,["member"])]),s("td",Ne,[y(oe,{label:p.label,name:`${p.name}[${o}]`,rules:a(ue),disabled:e.disabled},null,8,["label","name","rules","disabled"]),$(' TBD:: :rules="question.required ? validateParagraph : null" ')])]))),128))])])]))}}),Qe=D(Me,[["__file","/Users/josephkh/Workspace/iPeer/app/webroot/vue-ts-ipeer/src/student/views/questions/PeerSimpleCommentQuestion.vue"]]),Ae=A({__name:"SimpleEvaluation",props:{members:{type:Array,required:!0},currentUser:{type:null,required:!0},evaluation:{type:null,required:!0}},emits:["fetch:evaluation"],setup(p,{emit:L}){const e=p,S=ie();ne(),P();const i=K(e,"evaluation");let f=G({event_id:x(()=>{var t;return(t=i.value)==null?void 0:t.id}),group_id:x(()=>{var t,r;return(r=(t=i.value)==null?void 0:t.group)==null?void 0:r.id}),course_id:x(()=>{var t,r;return(r=(t=i.value)==null?void 0:t.course)==null?void 0:r.id}),group_event_id:x(()=>{var t;return(t=i.value)==null?void 0:t.group_event_id}),rubric_id:x(()=>{var t;return(t=i.value)==null?void 0:t.rubric_id}),user_id:x(()=>{var t;return(t=e.currentUser)==null?void 0:t.id}),evaluatee_count:x(()=>{var t,r;return(r=(t=i.value)==null?void 0:t.members)==null?void 0:r.length}),member_ids:x(()=>{var t;return k.exports.map((t=i.value)==null?void 0:t.members,r=>r.id)})});const o=P({});function _(){var t;return{id:"",submitter_id:(t=i.value)==null?void 0:t.id,submitted:null,date_submitted:"",data:{points:[],comments:[]}}}const n=G({points:{title:"1. Please rate each peer's relative contribution.",description:"Section description"},comments:{title:"2. Please provide overall comments about each peer.",description:"Section description"}}),R=x(()=>S.path==="submissions");return X(()=>{var t,r,l;((t=i.value)==null?void 0:t.response)&&!k.exports.isEmpty((r=i.value)==null?void 0:r.response)?o.value=Object.assign(_(),a((l=i.value)==null?void 0:l.response)):o.value=_()}),(t,r)=>(u(),J(le,{onSubmit:t.onSubmit,"initial-state":o.value,evaluation:e.evaluation},{default:re(({onSave:l,errors:c,values:b,isSubmitting:d,evaluationRef:v})=>[Q(t.$slots,"header",{},()=>{var h,q,g,w,V,B,F,j,E;return[y(a(U),{type:"hidden",name:"event_id",value:(h=e.evaluation)==null?void 0:h.id},null,8,["value"]),y(a(U),{type:"hidden",name:"group_id",value:(g=(q=e.evaluation)==null?void 0:q.group)==null?void 0:g.id},null,8,["value"]),y(a(U),{type:"hidden",name:"course_id",value:(V=(w=e.evaluation)==null?void 0:w.course)==null?void 0:V.id},null,8,["value"]),y(a(U),{type:"hidden",name:"data[Evaluation][evaluator_id]",value:(B=e.currentUser)==null?void 0:B.id},null,8,["value"]),y(a(U),{type:"hidden",name:"evaluateeCount",value:(j=(F=e.evaluation)==null?void 0:F.members)==null?void 0:j.length},null,8,["value"]),(u(!0),m(W,null,H((E=a(f))==null?void 0:E.member_ids,(N,M)=>(u(),J(a(U),{type:"hidden",name:"memberIDs[]",key:M,value:N},null,8,["value"]))),128))]}),Q(t.$slots,"main",{},()=>{var h,q,g;return[y(Re,{members:(h=a(i))==null?void 0:h.members,remaining:(q=a(i))==null?void 0:q.remaining,initialState:o.value,name:"points",question:n.points.title,description:n.points.description,disabled:a(R)},null,8,["members","remaining","initialState","question","description","disabled"]),y(Qe,{members:(g=a(i))==null?void 0:g.members,initialState:o.value,name:"comments",disabled:a(R),question:n.comments.title,description:n.comments.description},null,8,["members","initialState","disabled","question","description"])]}),Q(t.$slots,"footer"),Q(t.$slots,"cta",{onSave:l,isSubmitting:d,values:b})]),_:3},8,["onSubmit","initial-state","evaluation"]))}}),Ke=D(Ae,[["__file","/Users/josephkh/Workspace/iPeer/app/webroot/vue-ts-ipeer/src/student/views/templates/SimpleEvaluation.vue"]]);export{Ke as default};
//# sourceMappingURL=SimpleEvaluation.js.map
