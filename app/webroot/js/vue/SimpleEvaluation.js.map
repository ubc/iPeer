{"version":3,"file":"SimpleEvaluation.js","sources":["../../../../vue-ts-ipeer/src/components/fields/CustomRangeField.vue","../../../../vue-ts-ipeer/src/student/views/questions/PeerSimpleRangeQuestion.vue","../../../../vue-ts-ipeer/src/student/views/templates/SimpleEvaluation.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport {computed, toRefs} from 'vue';\nimport { useField } from 'vee-validate'\n\nexport interface Props {\n  label?: string\n  name: string\n  value: string\n  response: object\n  points: string | number\n  rules?: string\n  disabled?: boolean\n  placeholder?: string\n  min?: string | number\n  step?: string | number\n  max?: string | number\n  text?: string[]\n  showScore: boolean\n  remaining: number\n  point_per_member: string\n}\n\n// REFERENCES\nconst emit = defineEmits<{\n  (e: 'update:input', option: object): void\n}>()\nconst props = withDefaults(defineProps<Props>(), {\n  min: 0,\n  step: 1,\n  max: 100,\n  text: () => ['min', 'max'],\n  placeholder: '',\n  disabled: false\n})\n\nconst { name, value } = toRefs(props);\nconst { value: inputValue, errorMessage, handleBlur, handleChange, meta } = useField(name, props.rules, {\n  initialValue: props.value,\n  validateOnValueUpdate: true\n});\n// DATA\nconst needle = computed<number|string>(() => Number(inputValue.value)) // return calc(0% + inputValue.value+'px')\nconst validationListeners = {\n  blur: handleChange,\n  change: handleChange,\n  input: (e: unknown) => handleChange(e, !!errorMessage.value)\n}\n// COMPUTED\n// METHODS\n// WATCH\n// LIFECYCLE\n</script>\n\n<template>\n  <div class=\"block block-slider\" :class=\"{ 'has-error': !!errorMessage, success: meta.valid }\">\n    <label class=\"form-range form-range-inline flex flex-col\">\n      <span class=\"form-range-label text-slate-500\">{{ props.label }}</span>\n      <span class=\"tick\"></span>\n      <input class=\"form-range-input\" type=\"range\"\n             :min=\"props.min\" :step=\"props.step\" :max=\"props.max\"\n             :name=\"name\"\n             :value=\"inputValue\"\n             :disabled=\"disabled\"\n             v-on=\"validationListeners\"\n             @input=\"$emit('update:input', $event)\"\n             @blur=\"handleBlur\"\n      />\n    </label>\n    <div v-if=\"props.text\" class=\"flex justify-between items-center\">\n      <div v-if=\"props.text[0]\" class=\"min text-sm text-slate-500 font-normal\">{{ props.text[0] }}</div>\n      <div v-if=\"props.text[1]\" class=\"max text-sm text-slate-500 font-normal\">{{ props.text[1] }}</div>\n    </div>\n  </div>\n\n  <div v-if=\"props.showScore\" class=\"range-review extended\">\n    <!--  SlickRangeSlider  -->\n  </div>\n\n  <div v-if=\"props.showScore\" class=\"range-review extended\">\n    <!--  HeatGradientRangeSlider  -->\n    <div class=\"heat-gradient mx-12\">\n      <div class=\"gradient\">\n        <!--<div class=\"needle\" :data-value=\"needle\" :style=\"`left: calc(100% - 2.25px - ${needle}%)`\">{{ needle }}</div>-->\n        <div class=\"needle\" :data-value=\"needle\" :style=\"`left: calc(0% + ${needle}% - 2.25px)`\"></div>\n      </div>\n      <div class=\"axis\">\n        <span class=\"\">1</span>\n        <span class=\"\">2</span>\n        <span class=\"\">3</span>\n        <span class=\"\">4</span>\n        <span class=\"\">5</span>\n        <span class=\"\">6</span>\n        <span class=\"\">7</span>\n        <span class=\"\">8</span>\n        <span class=\"\">9</span>\n        <span class=\"active\">10</span>\n      </div>\n    </div>\n  </div>\n</template>\n","<script lang=\"ts\" setup>\nimport {ref, reactive, watch, computed, onMounted, toRef, onBeforeMount} from 'vue'\nimport { findIndex, forEach, map, reduce } from 'lodash'\nimport UserCard from '@/student/components/UserCard.vue'\nimport { CustomRangeField } from '@/components/fields'\nimport type { ISimpleEvaluation, ISimpleResponse, ISimpleReview, User } from '@/types/typings'\n// REFERENCES\nconst emit = defineEmits<{\n  // (e: 'update:modelValue', option: string): void\n}>()\nconst props = defineProps<{\n  members: User[]\n  initialState: ISimpleResponse\n  remaining: number\n  point_per_member: string\n  name: string\n  label?: string\n  question?: string\n  description?: string\n  placeholder?: string\n  disabled?: boolean|false\n}>();\n// DATA\nconst showScore       = ref(false)\nconst response        = toRef(props, 'initialState')\nconst total_points    = ref(props.remaining ?? props.members.length * props.point_per_member) // 100\nconst student_slider  = ref([])\nconst slider_sum      = ref(0)\nconst student_scores  = ref([])\n// COMPUTED\n// METHODS\nfunction updateStudentSlider(event: {target:string, key:string, value: string}) {\n  const {target, key, value} = event;\n  const oldValue = student_slider.value[key]\n  slider_sum.value += parseInt(value) - oldValue\n  if (slider_sum.value <= 0){\n    student_scores.value = map(student_scores.value, () => total_points.value / student_scores.value.length)\n  } else {\n    student_slider.value[key] = parseInt(value);\n    student_scores.value = map(student_slider.value, (sliderValue) => Math.round(total_points.value * sliderValue / slider_sum.value))\n  }\n  distributeDecimalRemainder()\n  response.value.data.points = student_scores.value\n}\n// LIFECYCLE\nonBeforeMount(() => {\n  const initialPoints: number[] | undefined = response.value?.data?.points\n  if (initialPoints?.length) {\n    student_scores.value = [...initialPoints]\n    student_slider.value = map(initialPoints, (val, index) => {\n      const studentScoreValue = parseInt(val)\n      const studentPercentValue = studentScoreValue / total_points.value\n      const defaultStudentSliderValue = 100 * studentPercentValue\n      slider_sum.value += defaultStudentSliderValue;\n      return defaultStudentSliderValue\n    })\n  } else {\n    const defaultStudentSliderValue = Math.round(total_points.value / props.members.length)\n    student_slider.value = map(props.members, () => defaultStudentSliderValue)\n    slider_sum.value = defaultStudentSliderValue * props.members?.length\n    student_scores.value = map(props.members, () => total_points.value / props.members.length)\n  }\n})\n// WATCH\nfunction distributeDecimalRemainder() {\n  const studentScoreSum = reduce(student_scores.value, (acc, val) => acc += val, 0);\n  const remainder = total_points.value - studentScoreSum\n  const lowestScore = remainder > 0 ? Math.min(...student_scores.value) : Math.max(...student_scores.value)\n  const memberIdx = findIndex(student_scores.value, (val) => val === lowestScore)\n  student_scores.value[memberIdx] += remainder\n}\n</script>\n\n<template>\n  <div class=\"datatable\">\n    <div v-if=\"props.question\" class=\"question\">{{ props.question }}</div>\n    <div v-if=\"props.description\" class=\"description text-sm mx-4 mb-2\">{{ props.description }}</div>\n\n    <table class=\"standardtable\">\n      <thead>\n      <tr>\n        <th style=\"width: 20%\">\n          <div class=\"text-center leading-4\">\n            <div class=\"font-normal\">Peer</div>\n            <div class=\"text-sm font-thin\"></div>\n          </div>\n        </th>\n        <th style=\"width: 80%\">\n          <div class=\"text-center leading-4\">\n            <div class=\"font-normal\">Relative C<span  @click=\"showScore = !showScore\">o</span>ntribution</div>\n            <div class=\"text-sm font-thin\"></div>\n          </div>\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr v-for=\"(member, memberIdx) of props.members\" :key=\"member.id\">\n        <td style=\"width: 20%\"><UserCard :member=\"member\" /></td>\n        <td style=\"width: 80%\">\n          <input type=\"hidden\" :name=\"`${name}[${memberIdx}]`\" :value=\"response?.data && response?.data[name] ? response?.data[name][memberIdx] : ''\" />\n          <CustomRangeField\n              :text=\"['Less', 'More']\"\n              :label=\"'A fair amount'\"\n              :name=\"`percent[${memberIdx}]`\"\n              :value=\"response?.data?.points[memberIdx]\"\n              :response=\"response?.data?.points\"\n              :points=\"response?.data && response?.data?.points ? response?.data?.points[memberIdx] : ''\"\n              :placeholder=\"placeholder\"\n              :disabled=\"props.disabled\"\n              :remaining=\"remaining\"\n              :point_per_member=\"point_per_member\"\n              :showScore=\"showScore\"\n              @update:input=\"updateStudentSlider({target:name, key:memberIdx, value: $event.target.value})\"\n          />\n          <!--\n          :max=\"props.remaining\"\n          :value=\"student_slider[memberIdx]\"\n          -->\n          <div v-if=\"showScore\" class=\"text-sm text-red-400\">{{ response?.data && response?.data?.points ? response?.data?.points[memberIdx] : '' }}</div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</template>","<script lang=\"ts\" setup>\nimport { ref, unref, toRef, reactive, watch, computed, onBeforeMount } from 'vue';\nimport { useRoute, useRouter } from 'vue-router'\nimport { isEmpty, map } from 'lodash'\n\nimport TakeNote from '@/student/components/TakeNote.vue'\nimport EvaluationForm from '@/student/views/EvaluationForm.vue'\nimport PeerSimpleRangeQuestion from '@/student/views/questions/PeerSimpleRangeQuestion.vue'\nimport PeerSimpleCommentQuestion from '@/student/views/questions/PeerSimpleCommentQuestion.vue'\nimport { CustomHiddenField } from '@/components/fields'\n\nimport type { IUser, IEvaluation, ISimpleEvaluation, ISimpleEvaluationData, ISimpleResponse, ISimpleResponseData } from '@/types/typings'\n// REFERENCES\nconst emit = defineEmits<{\n  (e: 'fetch:evaluation'): void\n}>()\nconst props = defineProps<{\n  members: IUser[]\n  currentUser: IUser\n  evaluation: IEvaluation\n  disabled: boolean\n}>()\nconst route = useRoute()\nconst router = useRouter()\n// DATA\nconst evaluation_form = ref()\nconst evaluation      = toRef(props, 'evaluation')\nconst form              = reactive({\n  event_id: computed(() => evaluation.value?.id),\n  group_id: computed(() => evaluation.value?.group?.id),\n  course_id: computed(() => evaluation.value?.course?.id),\n  group_event_id: computed(() => evaluation.value?.group_event_id),\n  rubric_id: computed(() => evaluation.value?.rubric_id),\n  user_id: computed(() => props.currentUser?.id),\n  evaluatee_count: computed(() => evaluation.value?.members?.length),\n  member_ids: computed<string[]>(() => map(evaluation.value?.members, member => member.id))\n})\nconst initialState      = ref<ISimpleResponse|any>({})\nfunction getInitialState() {\n  return {\n    id: '',\n    submitter_id: props.currentUser?.id,\n    submitted: null,\n    date_submitted: '',\n    data: {\n      points: [],\n      comments: []\n    }\n  }\n}\n// points: [map(props.evaluation?.members, (member) => props.evaluation?.simple?.point_per_member)],\nfunction setInitialState() {}\nconst questions = reactive({\n  points: {\n    title: '1. Please rate each peer\\'s relative contribution.',\n    description: ''\n  },\n  comments: {\n    title: '2. Please provide overall comments about each peer.',\n    description: ''\n  }\n})\n// COMPUTED\n// const isDisabled = computed(() => {\n//   if(route.path === 'submissions') {\n//     return true\n//   }\n//   return false // TODO:: determined by the evaluation settings\n//   // return new Date().toLocaleDateString('en-CA', {}) >= new Date(props.evaluation?.due_date).toLocaleDateString('en-CA', {})\n// })\n// METHODS\n// WATCH\n// LIFECYCLE\nonBeforeMount(() => {\n  const currentState = getInitialState()\n  if(evaluation.value?.response && !isEmpty(evaluation.value?.response)) {\n    initialState.value = Object.assign(currentState, unref(evaluation.value?.response))\n  } else {\n    initialState.value = currentState\n  }\n})\n</script>\n\n<template>\n  <EvaluationForm\n      @submit=\"onSubmit\"\n      :initial-state=\"initialState\"\n      :evaluation=\"evaluation\"\n      v-slot=\"{ onSave, errors, values, isSubmitting, evaluationRef }\"\n  >\n    <slot name=\"header\">\n      <CustomHiddenField type=\"hidden\" name=\"event_id\" :value=\"evaluation?.id\" />\n      <CustomHiddenField type=\"hidden\" name=\"group_id\" :value=\"evaluation?.group?.id\" />\n      <CustomHiddenField type=\"hidden\" name=\"course_id\" :value=\"evaluation?.course?.id\" />\n      <CustomHiddenField type=\"hidden\" name=\"data[Evaluation][evaluator_id]\" :value=\"currentUser?.id\" />\n      <CustomHiddenField type=\"hidden\" name=\"evaluateeCount\" :value=\"evaluation?.members?.length\" />\n      <CustomHiddenField type=\"hidden\" name=\"memberIDs[]\" v-for=\"(m,i) of form?.member_ids\" :key=\"i\" :value=\"m\" />\n    </slot>\n\n    <slot name=\"main\">\n      <!---->\n      <PeerSimpleRangeQuestion\n          :members=\"evaluation?.members\"\n          :remaining=\"evaluation?.simple?.remaining\"\n          :point_per_member=\"evaluation?.simple?.point_per_member\"\n          :initialState=\"initialState\"\n          :name=\"`points`\"\n          :question=\"questions.points.title\"\n          :description=\"questions.points.description\"\n          :disabled=\"disabled\"\n      />\n      <PeerSimpleCommentQuestion\n          :members=\"evaluation?.members\"\n          :initialState=\"initialState\"\n          :name=\"'comments'\"\n          :question=\"questions.comments.title\"\n          :description=\"questions.comments.description\"\n          :disabled=\"disabled\"\n      />\n    </slot>\n\n    <slot name=\"footer\"></slot>\n\n    <slot name=\"cta\" :on-save=\"onSave\" :is-submitting=\"isSubmitting\" :values=\"values\"></slot>\n\n  </EvaluationForm>\n</template>\n"],"names":["name","value","toRefs","props","inputValue","errorMessage","handleBlur","handleChange","meta","useField","needle","computed","validationListeners","e","showScore","ref","response","toRef","total_points","_a","student_slider","slider_sum","student_scores","updateStudentSlider","event","target","key","oldValue","map","sliderValue","distributeDecimalRemainder","onBeforeMount","initialPoints","_b","val","index","studentPercentValue","defaultStudentSliderValue","_c","studentScoreSum","reduce","acc","remainder","lowestScore","memberIdx","findIndex","useRoute","useRouter","evaluation","form","reactive","member","initialState","getInitialState","questions","currentState","isEmpty","unref"],"mappings":"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"}